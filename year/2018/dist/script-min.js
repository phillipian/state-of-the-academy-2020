function generateTooltip(t){return"<h4>"+t.title+"</h4><p>Responses: <strong>"+t.responses+"</strong>"+(t.percentage?"<br>Percentage: <strong>"+(100*t.percentage).toFixed(1)+"%</strong>":"")+"</p>"}function generateTooltipMultiline(t){var e="",a="";t.responses=t.responses.map(function(e,a){return{data:e,color:t.colors[a]}});for(var s=0;s<t.responses.length;s++)e+="<div class = 'bubble' style = 'background:"+t.responses[s].color+"'></div> <span>"+t.labels[s]+": "+t.responses[s].data+"</span><br>",a+="<div class = 'bubble' style = 'background:"+t.responses[s].color+"'></div> <span>"+t.labels[s]+": "+(100*t.responses[s].data/t.total).toFixed(1)+"%</span><br>";return"<h4>"+t.title+"</h4><p>Responses:</p>"+e+"<br><p>Percentage (for each category):</p>"+a}$(document).ready(function(){$("#sidebar a").on("click",function(t){if(""!==this.hash){t.preventDefault();var e=this.hash;$("html, body").animate({scrollTop:$(e).offset().top},800,function(){window.location.hash=e})}}),$(document).scroll(function(){$(document).width()>900&&($(document).scrollTop()+60>$("#sections").offset().top?($("#sidebar").css("position","fixed"),$("#sidebar").css("top","40px")):($("#sidebar").css("position","absolute"),$("#sidebar").css("top","80px")))}),$(window).resize(function(){$(document).width()>900?$(document).scrollTop()+60>$("#sections").offset().top?($("#sidebar").css("position","fixed"),$("#sidebar").css("top","40px")):($("#sidebar").css("position","absolute"),$("#sidebar").css("top","80px")):($("#sidebar").css("position","relative"),$("#sidebar").css("top","0px"))})});var barChartLength=d3.selectAll(".barchart").size(),dataForBarCharts=new Array(barChartLength),totalForBarCharts=new Array(barChartLength);function drawBarChart(t,e,a){var s,r,n,l,o,i={top:20,right:20,bottom:50,left:50},d={top:20,right:20,bottom:50,left:70},c=t.dataset.accent,h=parseInt(t.dataset.height)-i.top-i.bottom,p=t.dataset.x,u=t.dataset.y,f=d3.select(t.firstChild),g=d3.select("#sections").node().offsetWidth-i.left-i.right,m=t.className.split(" ")[1],b="true"==t.dataset.percent;if("leftmargin"in t.dataset?d.left=parseInt(t.dataset.leftmargin):b&&(i.left=60),d3.select(t).select("svg").selectAll("*").remove(),d3.select(t).select(".bar-label").remove(),l=d3.select(t).select("svg").attr("width",g+d.left+d.right).attr("height",h+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")"),"barchart-horizontal"==m)g=d3.select("#sections").node().offsetWidth-d.left-d.right,r=d3.scaleLinear().range([0,g]),n=d3.scaleBand().range([h,0]).padding(.2),r.domain([0,d3.max(e,function(t){return t.y})]),n.domain(e.map(function(t){return t.label})),l.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",1).attr("height",n.bandwidth()).style("fill",c).attr("y",function(t){return n(t.label)}).attr("width",function(t){return r(t.y)});else if("barchart-grouped"==m){r=d3.scaleBand().rangeRound([0,g]).paddingInner(.1);var y=d3.scaleBand().padding(.05);n=d3.scaleLinear().rangeRound([h,0]);for(var x=t.dataset.colors.split(","),v=[],w=0;w<e[0].y.length;w++)v.push(w);r.domain(e.map(function(t){return t.label})),y.domain(v).rangeRound([0,r.bandwidth()]),b?n.domain([0,100]):n.domain([0,d3.max(e,function(t){return d3.max(v,function(e){return t.y[e]})})]).nice(),l.append("g").selectAll("g").data(e).enter().append("g").attr("transform",function(t){return"translate("+r(t.label)+",0)"}).selectAll("rect").data(function(t){return v.map(function(e){return{key:e,value:t.y[e],label:t.label}})}).enter().append("rect").attr("class","bar").attr("x",function(t){return y(t.key)}).attr("y",function(t){return n(t.value)}).attr("width",y.bandwidth()).attr("height",function(t){return h-n(t.value)}).attr("fill",function(t,e){return x[e]})}else if(r=d3.scaleBand().range([0,g]).paddingInner(.2),n=d3.scaleLinear().range([h,0]),r.domain(e.map(function(t){return t.label})),"barchart-stacked"==m){n.domain([0,d3.max(e,function(t){return"number"==typeof t.y?t:t.y.reduce(function(t,e){return t+e},0)})]).nice();var A=0;for(x=t.dataset.colors.split(","),v=[],w=0;w<e[0].y.length;w++)v.push(w);l.append("g").selectAll("g").data(d3.stack().keys(v)(e)).enter().append("g").attr("fill",function(t,e){return x[e]}).selectAll("rect").data(function(t){return t}).enter().append("rect").attr("x",function(t){return r(t.data.label)}).attr("y",function(t,a){A==e[0].y.length&&(A=0);for(var s=t.data.y[A],r=A;r>0;r--)s+=t.data.y[r-1];return A++,n(s)}).attr("height",function(t,a){return A==e[0].y.length&&(A=0),h-n(t.data.y[A++])}).attr("width",r.bandwidth())}else b?n.domain([0,100]):n.domain([0,d3.max(e,function(t){return t.y})]),l.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",function(t){return r(t.label)}).attr("width",r.bandwidth()).style("fill",c).attr("y",function(t){return n(t.y)}).attr("height",function(t){return h-n(t.y)});t.dataset.labels&&d3.select(t).append("div").attr("class","bar-label").attr("width","100%").selectAll("p").data(t.dataset.labels.split(",")).enter().append("p").html(function(t,e){return"<div class = 'bubble' style = 'background:"+(x[e]||c)+"'></div>"+t}),l.selectAll(".bar").on("mouseover",function(e,r){s="barchart-grouped"==m?b?"<h4>"+e.label+": "+t.dataset.labels.split(",")[e.key]+"</h4><p><strong>"+e.value.toFixed(1)+"%</strong></p>":generateTooltip({title:e.label+": "+t.dataset.labels.split(",")[e.key],responses:e.value,percentage:e.value/a}):b?"<h4>"+e.label+"</h4><p><strong>"+e.y.toFixed(1)+"%</strong></p>":generateTooltip({title:e.label,responses:e.y,percentage:e.y/a}),f.classed("hidden",!1).html(s),"barchart-horizontal"!=m&&"barchart-vertical"!=m||d3.select(this).style("fill",d3.rgb(d3.color(c).brighter(.5))),o=d3.mouse(t),f.style("left",o[0]-f.node().offsetWidth/2+"px").style("top",o[1]-f.node().offsetHeight-12+"px")}).on("mousemove",function(e){o=d3.mouse(t),f.style("left",o[0]-f.node().offsetWidth/2+"px").style("top",o[1]-f.node().offsetHeight-12+"px")}).on("mouseout",function(t){f.classed("hidden",!0),d3.select(this).style("fill",c)}),"barchart-horizontal"==m?(l.append("g").attr("class","xAxis").attr("transform","translate(0,"+h+")").call(d3.axisBottom(r).ticks(5)),l.append("g").attr("class","y axis").call(d3.axisLeft(n))):(l.append("g").attr("class","xAxis").attr("transform","translate(0,"+h+")").call(d3.axisBottom(r)),b?l.append("g").attr("class","y axis").call(d3.axisLeft(n).ticks(5).tickFormat(function(t){return t+"%"})):l.append("g").attr("class","y axis").call(d3.axisLeft(n).ticks(5))),l.append("text").attr("transform","rotate(-90)").attr("y",-1*("barchart-horizontal"==m?d.left:i.left)).attr("x",0-h/2).attr("dy","1em").style("text-anchor","middle").style("font-family","source_sans_pro").style("font-weight","bold").text("barchart-horizontal"==m?p:u),l.append("text").attr("transform","translate("+g/2+" ,"+(h+i.top+20)+")").style("text-anchor","middle").style("font-family","source_sans_pro").style("font-weight","bold").text("barchart-horizontal"==m?u:p),l.select(".xAxis").selectAll("text").style("font-family","source_sans_pro").style("font-size","12px")}var barCharts=d3.selectAll(".barchart").each(function(t,e){var a=this;$.ajax({url:this.dataset.url,success:function(t){var s=parseInt(a.dataset.total||0),r=[];t.split("\n").forEach(function(t){var e=t.split(","),n=e.slice(1);e[0]&&(null==a.dataset.total&&(s+=parseFloat(e[1])),r.push({y:n.length>1?n.map(function(t){return parseFloat(t)}):parseFloat(e[1]),label:e[0]}))}),d3.select(a).append("svg"),dataForBarCharts[e]=r,totalForBarCharts[e]=s,drawBarChart(a,r,s)},dataType:"text"})}),margin={top:20,right:20,bottom:50,left:50},graphLength=d3.selectAll(".line_chart").size(),dataForGraphs=new Array(graphLength),totalForGraphs=new Array(graphLength),bisectors=new Array(graphLength),colorsForGraphs=new Array(graphLength),numLinesGraphs=new Array(graphLength);function drawGraph(t,e,a,s,r,n,l,o,i,d,c,h,p,u){var f,g=d3.scalePoint().rangeRound([0,s]).padding(.1),m=d3.scaleLinear().rangeRound([r,0]);thisNode=d3.select(t);for(var b,y=[],x=0;x<h;x++)b=d3.line().x(function(t){return g(t.x)}).y(function(t){return m(t.y[x])}),y.push(b);thisNode.select("svg").selectAll("*").remove(),g.domain(e.map(function(t){return""+t.x})),m.domain([0,d3.max(e,function(t){return d3.max(t.y)})]),g.invert=d3.scaleQuantize().domain(g.range()).range(g.domain());var v=thisNode.select("svg").attr("width",s+margin.left+margin.right).attr("height",r+margin.top+margin.bottom).on("mousemove",function(){for(var s,r=g.invert(d3.mouse(this)[0]),n=0;n<e.length;n++)if(e[n].x==r){s=e[n-1];break}f=h>1?generateTooltipMultiline({title:s.x,responses:s.y,colors:p,total:a,labels:t.dataset.labels.split(",")}):generateTooltip({title:s.x,responses:s.y,percentage:s.y/a}),l.classed("hidden",!1).html(f),l.style("left",g(s.x)+margin.left-Math.round(l.node().offsetWidth/2)+"px").style("top",m(d3.max(s.y))-Math.round(l.node().offsetHeight)-12+margin.top+"px")}).on("mouseout",function(t){var e=d3.event.toElement;e&&e.parentNode.parentNode!=this.parentNode&&e.parentNode!=this.parentNode&&e!=this.parentNode&&l.classed("hidden",!0)}).append("g").attr("transform","translate("+margin.left+","+margin.top+")");for(x=0;x<h;x++)if("false"==c&&v.append("path").data([e]).attr("class","line").style("stroke",p[x]).style("stroke-width","2px").style("fill","none").attr("d",y[x]),"true"==u){var w=d3.area().x(function(t){return g(t.x)}).y0(function(t){return 0==x?r:m(t.y[x-1])}).y1(function(t){return m(t.y[x])});v.append("path").data([e]).attr("fill",p[x]).style("opacity","0.5").style("z-index","20").attr("d",w)}for(x=0;x<h;x++)v.selectAll(".dot-"+x).data(e).enter().append("circle").attr("class","dot-"+x).style("fill",p[x]).attr("cx",function(t){return g(t.x)}).attr("cy",function(t){return m(t.y[x])}).attr("r",5);v.append("g").style("font-family","source_sans_pro").attr("transform","translate(0,"+r+")").call(d3.axisBottom(g)),v.append("g").style("font-family","source_sans_pro").call(d3.axisLeft(m)),v.append("text").attr("transform","rotate(-90)").attr("y",0-margin.left).attr("x",0-r/2).attr("dy","1em").style("text-anchor","middle").style("font-family","source_sans_pro").style("font-weight","bold").text(d),v.append("text").attr("transform","translate("+s/2+" ,"+(r+margin.top+20)+")").style("text-anchor","middle").style("font-family","source_sans_pro").style("font-weight","bold").text(i)}d3.selectAll(".line_chart").each(function(t,e){for(var a=d3.color(this.dataset.accent),s=d3.select(this),r=this,n=this.dataset.csv,l=this.dataset.x,o=this.dataset.y,i=d3.select(this.firstChild),d=this.dataset.lines,c=this,h=[],p=0,u=[],f=0;f<d;f++)u.push(d3.color(a.brighter(2*f)));$.ajax({url:n,success:function(t){t.split("\n").map(function(t){var e=t.split(",");e[0]&&(p+=parseFloat(e[1]),h.push({x:e[0],y:e.slice(1).map(function(t){return parseFloat(t)})}))});var n=d3.bisector(function(t){return t.x}).right;dataForGraphs[e]=h,totalForGraphs[e]=p,bisectors[e]=n,numLinesGraphs[e]=d,colorsForGraphs[e]=u;var f=d3.select("#sections").node().offsetWidth-margin.left-margin.right,g=parseInt(r.dataset.height)-margin.top-margin.bottom;if(s.append("svg"),drawGraph(c,h,p,f,g,a,i,n,l,o,r.dataset.scatter,d,u,r.dataset.shade),d>1){var m=r.dataset.labels.split(",");d3.select(r).append("div").attr("class","line-label").attr("width","100%").selectAll("p").data(u).enter().append("p").html(function(t,e){return"<div class = 'bubble' style = 'background:"+t+"'></div> "+m[e]})}},dataType:"text"})}),d3.selectAll(".map").each(function(){var t=0,e=["Discontinuous","Northeast","Southeast","Southwest","West","Midwest","International"],a=d3.color(this.dataset.accent),s=["#abdde3","#74cee0","#42b6da","#1e8cb9","#13659d","#0c3d8b","#182552"],r=this.dataset.responses.split(",").map(function(a,s){return t+=parseInt(a),{responses:parseInt(a),name:e[s]}}),n=r.slice().sort(function(t,e){return t.responses-e.responses});r=r.map(function(t,e){return{responses:t.responses,name:t.name,color:s[n.indexOf(t)]}});var l,o=this,i=d3.select(this.firstChild);d3.svg(this.dataset.url).then(function(e){var s=e.documentElement;d3.select(o).node().appendChild(s),d3.select(s).selectAll("*").data(r).style("fill",function(t,e){return d3.rgb(t.color)}).on("mouseover",function(e,s){d3.select(this).style("fill",d3.rgb(a.brighter(.3))),l=generateTooltip({title:e.name,responses:e.responses,percentage:e.responses/t}),i.classed("hidden",!1).html(l)}).on("mousemove",function(t){var e=d3.mouse(o);i.style("left",e[0]-Math.round(i.node().offsetWidth/2)+"px").style("top",e[1]-Math.round(i.node().offsetHeight)-10+"px")}).on("mouseout",function(t){d3.select(this).style("fill",d3.rgb(t.color)),i.classed("hidden",!0)})})});var multipane=d3.selectAll(".multipane").each(function(){var t=this.dataset.labels.split(","),e=this.id;d3.select(this).insert("div",":first-child").attr("class","multipane-labels").html(function(a){for(var s="",r=0;r<t.length;r++)s+="<a "+(0==r?"class = 'selected'":"")+" onclick = 'switchPane("+r+',"'+e+"\", this)'>"+t[r]+"</a>";return s});for(var a=this.children,s=2;s<a.length;s++)d3.select(a[s]).classed("hidden",!0)});function switchPane(t,e,a){d3.select("#"+e).select(".multipane-labels").selectAll("*").each(function(e,a){a==t?d3.select(this).classed("selected",!0):d3.select(this).classed("selected",!1)}),d3.selectAll("#"+e+">div").each(function(e,a){a>0&&(a-1==t?d3.select(this).classed("hidden",!1):d3.select(this).classed("hidden",!0))})}var resizeId,percentageSliders=d3.selectAll(".percentage-slider").each(function(){var t=parseInt(this.dataset.yes),e=parseInt(this.dataset.no),a=generateTooltip({title:"Yes",responses:t,percentage:t/(t+e)}),s=generateTooltip({title:"No",responses:e,percentage:e/(t+e)}),r=this.dataset.accent,n=d3.rgb(d3.color(r).brighter(.5)),l=d3.select(this.firstChild),o=parseInt(d3.select(this.children[1]).node().style.width.replace("%","")),i=parseInt(d3.select(this.children[2]).node().style.width.replace("%",""));d3.select(this.children[1]).on("mouseover",function(t){l.classed("hidden",!1).html(a).style("left","calc("+Math.round(o/2)+"% - "+Math.round(l.node().offsetWidth/2)+"px)").style("top","-"+(Math.round(l.node().offsetHeight)+10)+"px"),d3.select(this).style("background-color",n)}).on("mouseout",function(t){l.classed("hidden",!0),d3.select(this).style("background-color",r)}),d3.select(this.children[2]).on("mouseover",function(t){l.classed("hidden",!1).html(s).style("left","calc("+Math.round(o+i/2)+"% - "+Math.round(l.node().offsetWidth/2)+"px)").style("top","-"+(Math.round(l.node().offsetHeight)+10)+"px"),d3.select(this).style("background-color","#f4f4f4")}).on("mouseout",function(t){l.classed("hidden",!0),d3.select(this).style("background-color","white")})}),pieCharts=d3.selectAll(".pie").each(function(){var t,e,a=this.dataset.responses.split(","),s=this.dataset.labels.split(","),r=this.dataset.colors.split(","),n=2*parseInt(this.dataset.radius)||300,l=2*parseInt(this.dataset.radius)||300,o=parseInt(this.dataset.radius)||150,i=this.dataset.name,d=0,c=a.map(function(t,e){return d+=parseInt(t),{label:s[e],value:parseInt(t),color:r[e]}}),h=d3.pie().value(function(t){return t.value}).sort(null),p=d3.arc().outerRadius(o).innerRadius(0),u=d3.select(this).select(".tooltip"),f=this;d3.select(this).style("width",n);d3.select(this).append("svg").attr("width",n).attr("height",l).append("g").attr("transform","translate("+(n-o)+","+(l-o)+")").selectAll("path").data(h(c)).enter().append("path").attr("fill",function(t,e){return t.data.color}).attr("stroke","white").attr("d",p).on("mouseover",function(e,a){t=generateTooltip({title:e.data.label,responses:e.value,percentage:e.value/d}),u.classed("hidden",!1).html(t)}).on("mousemove",function(t){e=d3.mouse(f),u.style("left",e[0]-Math.round(u.node().offsetWidth/2)+"px").style("top",e[1]-Math.round(u.node().offsetHeight)-12+"px"),d3.select(this).style("fill",d3.rgb(d3.color(t.data.color).brighter(.5)))}).on("mouseout",function(t){u.classed("hidden",!0),d3.select(this).style("fill",t.color)});var g=d3.select(this).append("div").attr("class","pie-label").style("width",n+"px");i&&g.append("h3").html(i),g.selectAll("span").data(c).enter().append("span").html(function(t,e){return"<div class = 'bubble' style = 'background:"+t.color+"'></div>"+t.label}).append("br")});d3.select(window).on("resize",function(){resizeId=setTimeout(function(){d3.selectAll(".line_chart").each(function(t,e){d3.select(this);var a=d3.select("#sections").node().offsetWidth-margin.left-margin.right,s=parseInt(this.dataset.height)-margin.top-margin.bottom;drawGraph(this,dataForGraphs[e],totalForGraphs[e],a,s,this.dataset.accent,d3.select(this.firstChild),bisectors[e],this.dataset.x,this.dataset.y,this.dataset.scatter,numLinesGraphs[e],colorsForGraphs[e],this.dataset.shade)}),d3.selectAll(".barchart").each(function(t,e){drawBarChart(this,dataForBarCharts[e],totalForBarCharts[e])})},500)});