!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("d3")):"function"==typeof define&&define.amd?define(["d3"],a):(t=t||self).sota=a(t.d3)}(this,(function(t){"use strict";var a={separatorStrokeWidth:1,barHeight:32,barMargin:16,labelLeft:6,labelBelow:8,groupLabelMargin:32,xAxisTop:24,overflowOffset:24,lineColor:"#777777",labelColor:"#777777",mainHeight:300,tickSize:4,labelAngle:30,groupedBarChart:{barHeight:24,barMargin:8},margin:{top:20,bottom:20,left:0,right:0},swatch:{between:12,belowBetween:8,right:24,width:32,height:24,below:16}};function e(a){const e=a.node().offsetWidth/2,n=t.event.pageX;return n-e<0?e:n+e>window.innerWidth?window.innerWidth-e:n}function n(a){return t.format(".1f")(a)+"%"}function l(l,s,r,o,i){l.on("mouseover",(function(l,c){t.select(this).attr("opacity",a.hoverOpacity),s.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"></span><span class="sota-heavy-label">${o[c]}</span><br/>Percentage: ${n(r[c])}`;return i&&(t+="<br/>Number of responses: "+i[c]),t+="</span>",t}).style("left",e(s)+"px").style("top",t.event.pageY+"px")})).on("mousemove",a=>{s.style("left",e(s)+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),s.style("opacity",0)}))}function s(a,e,n=null){return n=null==n?t.sum(a,t=>+t.value):n,[e?a.map(t=>+t.value).keys:a.map(t=>+t.value/n*100),!e&&a.map(t=>+t.value),a.map(t=>t.label)]}function r(t,a){for(let e of t._groups)if(Array.isArray(e))for(let t of e)o(t,a);else o(e,a)}function o(t,a){t.getBBox().x<a&&(t.style.display="none")}let i={barChart:function({selector:e,dataFile:r,inputIsPercentage:o=!1,showXAxis:i=!0,showSeparators:c=!0,displayPercentage:h=!0,totalResp:p=null,maxVal:d=null,minVal:g=null,margin:f=a.margin}){const m=a.tickSize,u=a.separatorStrokeWidth,x=a.labelLeft,b=a.barHeight,y=a.barMargin,w=a.overflowOffset,v=a.xAxisTop,B=t.select(e).append("svg"),C=t.select("body").append("div").attr("class","tooltip"),k=document.querySelector(e).offsetWidth,A=k-f.left-f.right,$=B.append("g").attr("class","sota-barChart-mainChart").attr("transform",`translate(${f.left+w} ${f.right})`).attr("width",A);t.csv(r+".csv").then(a=>{const r=b+y;let j=a.length*r;const[G,S,M]=s(a,o,p),L=h||o?G:S;if(null==g)g=o||h?0:t.min(L);else if(!0===g)g=t.min(L);else if(isNaN(g)||""===g)throw"invalid minVal for graph on "+e;if(null==d)d=o||h?100:t.max(L);else if(!0===d)d=t.max(L);else if(isNaN(d)||""===d)throw"invalid maxVal for graph on "+e;const P=t.scaleLinear().domain([g,d]).range([0,A]);let N;function W(t){return t*r}if(i&&(N=$.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-num-axis").call(t.axisBottom(P).tickSize(-m)).attr("transform","translate(0 "+(j+v)+")")),$.selectAll(".sota-barChart-bar").data(L).join("rect").attr("class","sota-barChart-bar sota-gen-bar").attr("width",t=>P(t)).attr("height",b).attr("x",0).attr("y",(t,a)=>W(a)),$.selectAll(".sota-barChart-hiddenBar").data(L).join("rect").attr("class","sota-barChart-hiddenBar").attr("width",A).attr("height",b).attr("x",0).attr("y",(t,a)=>W(a)).attr("fill","transparent").call(l,C,G,M,S),$.selectAll(".sota-barChart-label").data(a).join("text").attr("class","sota-barChart-label sota-text-label sota-heavy-label").html(t=>t.label).attr("alignment-baseline","central").attr("x",x).attr("y",(t,a)=>W(a)+b/2),c&&$.selectAll(".sota-barChart-separator").data(L).join("line").attr("class","sota-barChart-separator").attr("x1",0).attr("x2",A).attr("y1",(t,a)=>W(a)+b+6).attr("y2",(t,a)=>W(a)+b+6).attr("stroke-width",u).attr("stroke","#dddddd"),$.selectAll(".sota-barChart-value").data(L).join("text").attr("class","sota-barChart-value sota-num-label").html((t,a)=>o||h?n(t):t).attr("alignment-baseline","central").attr("text-anchor","end").attr("x",A).attr("y",(t,a)=>W(a)+b/2),i){let a=[];N.selectAll("text").each((function(){a.push(this.getBBox().y+this.getBBox().height)})),j+=+t.max(a)}const T=j+f.top+f.bottom;B.style("width",k+2*w+"px").attr("height",T).style("margin-left",-w)})},pieChart:function({selector:e,dataFile:r,inputIsPercentage:o=!1,pieRad:i=150,pieThick:c=80,margin:h=a.margin}){const p=a.lineColor,d=a.separatorStrokeWidth,g=a.separatorStrokeWidth,f=a.swatch.between,m=a.swatch.right,u=a.swatch.width,x=a.swatch.height,b=a.swatch.belowBetween,y=a.swatch.below,w=a.overflowOffset,v=t.select(e),B=v.append("svg"),C=t.select("body").append("div").attr("class","tooltip"),k=v.node().offsetWidth,A=k-h.left-h.right,$=B.append("g").attr("class","sota-barChart-mainChart").attr("transform",`translate(${h.left+w} ${h.right})`).attr("width",A);A<2*i&&(i=A/2),c>i&&(c=50),h.top,h.bottom,t.csv(r+".csv").then(a=>{const[e,r,v]=s(a,o),j=t.pie()(e);let G=0,S=[];console.log(v.length);const M=t.scaleOrdinal().domain(v).range(t.map(v,(t,a)=>"module-fill-"+(v.length>3?a+1:2*a+1)).keys()),L=$.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${h.top})`);if(L.selectAll("nothing").data(a).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t.label).attr("x",(function(){S.push(this.getBBox().width)})).remove(),t.sum(S,t=>t)+3*f+2*m>A){let a=A-t.max(S)-u-f;L.selectAll(".sota-gen-legend-swatch").data(v).join("rect").attr("class",t=>"sota-gen-legend-swatch "+M(t)).attr("x",a).attr("y",(t,a)=>(x+b)*a).attr("width",u).attr("height",x),L.selectAll(".sota-gen-legend-text").data(v).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",a+u+f).attr("y",(t,a)=>(x+b)*a+x/2).attr("alignment-baseline","central"),G=v.length*x+(v.length-1)*b+y}else{let a=A-(t.sum(S,t=>t)+v.length*(u+f)+(v.length-1)*m);L.selectAll(".sota-gen-legend-swatch").data(v).join("rect").attr("class",t=>"sota-gen-legend-swatch "+M(t)).attr("x",(e,n)=>a+n*(u+f+m)+t.sum(S.slice(0,n),t=>t)).attr("y",0).attr("width",u).attr("height",x),L.selectAll(".sota-gen-legend-text").data(v).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(e,n)=>a+n*(u+f+m)+u+f+t.sum(S.slice(0,n),t=>t)).attr("y",x/2).attr("alignment-baseline","central"),G=x+y}const P=$.append("g").attr("transform","translate("+A/2+","+(i+G)+")"),N=t.arc().innerRadius(.8*i-.8*c).outerRadius(.8*i),W=t.arc().innerRadius(.9*i).outerRadius(.9*i);P.selectAll(".sota-pieChart-slice").data(j).join("path").attr("class",(t,a)=>"sota-pieChart-slice "+M(a)).attr("d",N).attr("stroke","#fff").style("stroke-width",g).call(l,C,e,v,r),P.selectAll(".sota-pieChart-polyline").data(j).join("polyline").attr("class","sota-pieChart-polyline").attr("stroke",p).style("fill","none").attr("stroke-width",d).attr("points",t=>{let a=N.centroid(t),e=W.centroid(t),n=W.centroid(t),l=t.startAngle+(t.endAngle-t.startAngle)/2;return n[0]=.95*i*(l<Math.PI?1:-1),[a,e,n]}),P.selectAll(".sota-pieChart-label").data(j).join("text").attr("class","sota-pieChart-label sota-num-label").text((t,a)=>n(e[a])).attr("alignment-baseline","central").attr("transform",t=>{let a=W.centroid(t),e=t.startAngle+(t.endAngle-t.startAngle)/2;return a[0]=.99*i*(e<Math.PI?1:-1),"translate("+a+")"}).style("text-anchor",t=>t.startAngle+(t.endAngle-t.startAngle)/2<Math.PI?"start":"end");const T=2*i+G+h.top+h.bottom;B.style("width",k+2*w+"px").attr("height",T).style("margin-left",-w)})},lineGraph:function({selector:e,dataFile:l,inputIsPercentage:s=!1,minVal:r=null,maxVal:o=null,height:i=300,customTooltipAppend:c="",prop5:h="value5",prop6:p="value6",margin:d={top:20,bottom:20,left:24,right:0}}){const g=t.select(e).append("svg").attr("class","sota-lineGraph"),f=t.select("body").append("div").attr("class","tooltip"),m=document.querySelector(e).offsetWidth;g.attr("height",i),t.csv(l+".csv").then(l=>{const c=a.separatorStrokeWidth,h=l.map(t=>t.label),p=l.map(t=>+t.value);if(null==r)r=s?0:t.min(l,t=>t.value);else if(1==r)r=t.min(l,t=>t.value);else if(isNaN(r)||""==r)throw"invalid minVal for graph on "+e;if(null==o)o=s?100:t.max(l,t=>t.value);else if(1==o)o=t.max(l,t=>t.value);else if(isNaN(o)||""==o)throw"invalid maxVal for graph on "+e;const u=t.scaleBand().domain(h.map(t=>t)).range([d.left,m-d.right]),x=t.scaleLinear().domain([r,o]).range([i-d.bottom,d.top]);g.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-text-axis").call(t.axisBottom(u).ticks(l.length).tickSize(-8)).style("transform","translateY("+(i-d.bottom)+"px)"),g.append("g").attr("class","sota-gen-axis sota-gen-YAxis sota-num-axis").call(t.axisLeft(x).tickSize(-8)).style("transform","translateX("+d.left+"px)"),g.selectAll(".sota-lineGraph-path").data([p]).join("path").attr("class","sota-lineGraph-path").attr("d",t.line().x((t,a)=>u(h[a])+u.bandwidth()/2).y(t=>x(t))).attr("fill","none").attr("stroke","#bbb").style("stroke-width",3),g.selectAll(".sota-lineGraph-circle").data(p).join("circle").attr("class","sota-lineGraph-circle").attr("cx",(t,a)=>u(h[a])+u.bandwidth()/2).attr("cy",t=>x(t)).attr("r",9).attr("stroke","white").style("stroke-width",c).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),f.style("opacity",1).html(`<span class="sota-tooltip-label">${h[e]}</span><br/>Value: `+(s?n(a):a)+"</span>").style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",a=>{f.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),f.style("opacity",0)})),g.selectAll(".sota-lineGraph-label").data(p).join("text").attr("class","sota-lineGraph-label sota-num-label").text((t,a)=>{if(s)return t+"%"}).attr("x",(t,a)=>u(h[a])+u.bandwidth()/2).attr("y",t=>x(t)-16).style("text-anchor","middle")})},stackedBarChart:function({selector:e,dataFile:l,inputIsPercentage:s=!1,showXAxis:o=!0,labelStyle:i="onBar",groupLabelStyle:c="none",showLegend:h=!0,prop5:p="value5",prop6:d="value6",margin:g=a.margin}){const f=a.separatorStrokeWidth,m=a.barHeight,u=a.barMargin,x=a.overflowOffset,b=a.groupLabelMargin,y=a.labelLeft,w=a.labelBelow,v=a.lineColor,B=a.swatch.between,C=a.swatch.right,k=a.swatch.width,A=a.swatch.height,$=a.swatch.belowBetween,j=a.swatch.below,G=a.xAxisTop;var S=t.select(e).append("svg"),M=t.select("body").append("div").attr("class","tooltip"),L=document.querySelector(e).offsetWidth,P=L-g.left-g.right;const N=S.append("g").attr("class","sota-stackedBarChart-mainChart").attr("transform",`translate(${g.left+x} ${g.right})`).attr("width",P);t.csv(l+".csv").then(a=>{var e=m+u,l=a.length*e,p=0;"onBar"==c&&(e+=a.length*b,l+=a.length*b,p=b);const d=a.columns.slice(1),W=t.map(a,t=>t.group).keys();var T=[];s?a.forEach(t=>{let a=0,e=[];for(let n of d){let l=+t[n];e.push([l,a]),a+=l}T.push(e)}):a.forEach(a=>{let e=0,n=t.sum(d,t=>+a[t]),l=[];for(let t of d){let s=+a[t]/n*100;l.push([s,e,+a[t]]),e+=s}T.push(l)});const I=t.scaleBand().domain(W).range([0,l]).padding([.2]),V=t.scaleLinear().domain([0,100]).range([0,P]),z=t.scaleOrdinal().domain(d).range(t.map(d,(t,a)=>"module-fill-"+(d.length>3?a+1:2*a+1)).keys());o&&(N.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-num-axis").call(t.axisBottom(V).ticks(a.length).tickSize(-8)).attr("transform","translate(0 "+(l+G)+")"),l+=20+G);var O=0;if(h){let a=[];const e=S.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${g.top})`);if(e.selectAll("nothing").data(d).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(function(){a.push(this.getBBox().width)})).remove(),t.sum(a,t=>t)+3*B+2*C>P){let n=P-t.max(a)-k-B;e.selectAll(".sota-gen-legend-swatch").data(d).join("rect").attr("class",t=>"sota-gen-legend-swatch "+z(t)).attr("x",n).attr("y",(t,a)=>(A+$)*a).attr("width",k).attr("height",A),e.selectAll(".sota-gen-legend-text").data(d).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",n+k+B).attr("y",(t,a)=>(A+$)*a+A/2).attr("alignment-baseline","central"),O=d.length*A+(d.length-1)*$+j}else{let n=P-(t.sum(a,t=>t)+d.length*(k+B)+(d.length-1)*C);e.selectAll(".sota-gen-legend-swatch").data(d).join("rect").attr("class",t=>"sota-gen-legend-swatch "+z(t)).attr("x",(e,l)=>n+l*(k+B+C)+t.sum(a.slice(0,l),t=>t)).attr("y",0).attr("width",k).attr("height",A),e.selectAll(".sota-gen-legend-text").data(d).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(e,l)=>n+l*(k+B+C)+k+B+t.sum(a.slice(0,l),t=>t)).attr("y",A/2).attr("alignment-baseline","central"),O=A+j}}const Y=N.selectAll(".sota-stackedBarChart-group").data(T).join("g").attr("class","sota-stackedBarChart-group").attr("transform",(t,a)=>"translate(0 "+(I(W[a])+p-u)+")");Y.selectAll(".sota-stackedBarChart-bar").data(t=>t).join("rect").attr("class",(t,a)=>"sota-stackedBarChart-bar "+z(a)).attr("x",t=>V(t[1])).attr("y",0).attr("width",t=>V(t[0])).attr("height",m).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),M.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"><span class="sota-heavy-label">${d[e]}</span><br/>Percentage: ${n(a[0])}`;return s||(t+="<br/>Number of responses: "+a[2]),t+="</span>",t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{M.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),M.style("opacity",0)})),Y.selectAll(".sota-stackedBarChart-separator").data(t=>t).join("rect").attr("class","sota-stackedBarChart-separator").attr("fill","white").attr("x",t=>V(t[1])+V(t[0])).attr("y",0).attr("width",t=>t[0]>0?f:0).attr("height",m),"onBar"==c&&N.selectAll(".sota-stackedBarChart-groupLabel-onBar").data(W).join("text").attr("class","sota-stackedBarChart-groupLabel-onBar sota-text-label").text(t=>t).attr("alignment-baseline","bottom").attr("x",0).attr("y",t=>I(t));var X=0;if("onBar"==i)Y.selectAll(".sota-stackedBarChart-label-onBar").data(t=>t).join("text").attr("class","sota-stackedBarChart-label-onBar sota-num-label").text(a=>t.format(".1f")(a[0])+"%").attr("alignment-baseline","central").attr("text-anchor","end").attr("x",t=>V(t[1])+V(t[0])-y).attr("y",m/2).call(r,g.left);else if("aboveBar"==i){var F=[];Y.selectAll(".sota-stackedBarChart-label-aboveBar-text").data(t=>t).join("text").attr("class","sota-stackedBarChart-label-aboveBar-text sota-num-label").text((a,e)=>`${d[e]}: ${t.format(".1f")(a[0])}%`).attr("x",t=>V(t[1])+V(t[0])/2).attr("y",(function(t){return F.push([this.getBBox().x,this.getBBox().width]),-2*w})).attr("alignment-baseline","bottom");let a=[];!function t(e){if(e==F.length-1)return a[e]=-2,-2;if(F[e][0]+F[e][1]+y>F[e+1][0]){F[e+1][0]=F[e][0]+F[e][1]+y;let n=t(e+1)-1;return a[e]=n,n}return t(e+1),a[e]=-2,-2}(0),Y.selectAll(".sota-stackedBarChart-label-aboveBar-line").data(t=>t).join("polyline").attr("class","sota-stackedBarChart-label-aboveBar-line").attr("points",(t,e)=>{let n=V(t[1])+V(t[0])/2,l=m/2,s=n,r=(a[e]+1)*w;return`${n},${l} ${s},${r} ${F[e][0]+F[e][1]},${r}`}).attr("stroke-width",f).attr("stroke",v).attr("fill","none"),Y.selectAll(".sota-stackedBarChart-label-aboveBar-text").data(t=>t).join("text").attr("x",(t,a)=>F[a][0]).attr("y",(t,e)=>a[e]*w),X=-1*t.min(a)*w+20}const H=l+g.top+g.bottom+O+X;S.style("width",L+2*x+"px").attr("height",H).style("margin-left",-x),N.attr("transform",`translate(${x} ${g.top+O+X})`).attr("width",P)})},customBarChart:function({selector:e,dataFile:r,shapeFile:o,shapeWidth:i=300,inputIsPercentage:c=!1,margin:h=a.margin}){var p=t.select(e).append("svg"),d=t.select("body").append("div").attr("class","tooltip");const g=p.append("g").attr("class","sota-mainChart");var f=document.querySelector(e).offsetWidth;const m=a.separatorStrokeWidth,u=a.labelLeft,x=a.labelBelow,b=a.lineColor;t.xml("shapes/"+o+".svg").then(a=>{let o=document.importNode(a.documentElement,!0),y=t.select(o).select("path").node(),w=0,v=0;p.append(()=>y).attr("class",(function(){return w=this.getBBox().width,v=this.getBBox().height,""})).remove();let B=i/w,C=v*B;p.append("defs").append("clipPath").attr("id","shapeDef"+e.substring(1)).append(()=>y).attr("transform",`scale(${B})`),t.csv(r+".csv").then(a=>{const[r,o,y]=s(a,c);let w=0,v=[];for(let t of a)v.push(w),w+=+t.value;const B=t.scaleLinear().domain([0,t.sum(a,t=>+t.value)]).range([0,i]),k=t.scaleOrdinal().domain(t.map(a,t=>t.label)).range(t.map(a,(t,a)=>"module-fill-"+(a+1)).keys());g.selectAll(".sota-customBarChart-bar").data(a).join("rect").attr("class",t=>"sota-customBarChart-bar "+k(t.label)).attr("x",(t,a)=>B(v[a])).attr("y",0).attr("width",t=>B(t.value)).attr("height",C).attr("clip-path","url(#shapeDef"+e.substring(1)+")").call(l,d,r,y,o),g.selectAll(".sota-customBarChart-separator").data(a).join("rect").attr("class","sota-customBarChart-separator").attr("x",(t,a)=>0==a?-m:B(v[a])).attr("y",0).attr("width",m).attr("height",C).attr("fill","white").attr("clip-path","url(#shapeDef"+e.substring(1)+")");var A=[];g.selectAll(".sota-customBarChart-label-aboveBar-text").data(a).join("text").attr("class","sota-customBarChart-label-aboveBar-text").html((t,a)=>`<tspan class="sota-text-label sota-heavy-label">${t.label}:</tspan><tspan class="sota-num-label"> ${n(r[a])}</tspan>`).attr("x",(t,a)=>B(v[a])+B(t.value)/2+u).attr("y",(function(t){return A.push([this.getBBox().x,this.getBBox().width]),C+3*x})).attr("alignment-baseline","top");let $=[];!function t(a){if(a==A.length-1)return $[a]=3,3;if(A[a][0]+A[a][1]+2*u>A[a+1][0]){A[a+1][0]=A[a][0]+A[a][1]+2*u;let e=t(a+1)+1;return $[a]=e,e}return t(a+1),$[a]=3,3}(0),g.selectAll(".sota-customBarChart-label-aboveBar-line").data(a).join("polyline").attr("class","sota-customBarChart-label-aboveBar-line").attr("points",(t,a)=>{let e=B(v[a])+B(t.value)/2,n=C-x,l=e,s=C+($[a]+1)*x;return`${e},${n} ${l},${s} ${A[a][0]+A[a][1]},${s}`}).attr("stroke-width",m).attr("stroke",b).attr("fill","none"),g.selectAll(".sota-customBarChart-label-aboveBar-text").data(a).join("text").attr("x",(t,a)=>A[a][0]).attr("y",(t,a)=>C+$[a]*x);let j=t.max($)*x+20,G=C+h.top+h.bottom+j;p.attr("height",G),g.attr("transform",`translate(${h.left} ${h.top})`).attr("width",f-h.left-h.right)})})},columnChart:function({selector:e,dataFile:n,inputIsPercentage:r=!1,displayPercentage:o=!0,totalResp:i=null,maxVal:c=null,minVal:h=null,mainHeight:p=a.mainHeight,showLegend:d=!1,margin:g={top:20,bottom:20,left:24,right:0}}){const f=a.overflowOffset,m=a.tickSize,u=a.labelAngle,x=a.swatch.between,b=a.swatch.right,y=a.swatch.width,w=a.swatch.height,v=a.swatch.belowBetween,B=a.swatch.below,C=t.select(e).append("svg"),k=t.select("body").append("div").attr("class","tooltip"),A=C.append("g").attr("class","sota-mainChart"),$=document.querySelector(e).offsetWidth,j=$-g.left-g.right;t.csv(n+".csv").then(a=>{const[n,G,S]=s(a,r,i),M=o||r?n:G;if(null===h)h=r||o?0:t.min(M);else if(!0===h)h=t.min(M);else if(isNaN(h)||""===h)throw"invalid minVal for graph on "+e;if(null===c)c=r||o?100:t.max(M);else if(!0===c)c=t.max(M);else if(isNaN(c)||""===c)throw"invalid maxVal for graph on "+e;const L=t.scaleBand().domain(S).range([0,j]).padding([.3]),P=t.scaleLinear().domain([h,c]).range([p,0]),N=t.scaleOrdinal().domain(S).range(t.map(S,(t,a)=>"module-fill-"+(a+1)).keys());let W,T=0,I=!1;if(d){let e=[];const n=C.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${g.top})`);if(n.selectAll("nothing").data(a).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t.label).attr("x",(function(){e.push(this.getBBox().width)})).remove(),t.sum(e,t=>t)+e.length*x+(e.length-1)*b>j){let a=j-t.max(e)-y-x;n.selectAll(".sota-gen-legend-swatch").data(S).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",a).attr("y",(t,a)=>(w+v)*a).attr("width",y).attr("height",w),n.selectAll(".sota-gen-legend-text").data(S).join("text").attr("class","sota-gen-legend-text sota-text-label").text(t=>t).attr("x",a+y+x).attr("y",(t,a)=>(w+v)*a+w/2).attr("alignment-baseline","central"),T=S.length*w+(S.length-1)*v+B}else{let a=j-(t.sum(e,t=>t)+S.length*(y+x)+(S.length-1)*b);n.selectAll(".sota-gen-legend-swatch").data(S).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",(n,l)=>a+l*(y+x+b)+t.sum(e.slice(0,l),t=>t)).attr("y",0).attr("width",y).attr("height",w),n.selectAll(".sota-gen-legend-text").data(S).join("text").attr("class","sota-gen-legend-text sota-text-label").text(t=>t).attr("x",(n,l)=>a+l*(y+x+b)+y+x+t.sum(e.slice(0,l),t=>t)).attr("y",w/2).attr("alignment-baseline","central"),T=w+B}}else{W=A.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-text-axis").call(t.axisBottom(L).tickSize(0)).attr("transform",`translate(0 ${p})`);const a=W.selectAll("text"),e=a.nodes();for(let t in e){if(t==e.length-1)continue;let a=e[+t].getBBox(),n=e[+t+1].getBBox();if(a.x+a.width>n.x){I=!0;break}}I&&a.attr("text-anchor","end").style("transform",`translateY(4px) rotate(-${u}deg)`).node().classList.add("angled-label")}A.append("g").attr("class","sota-gen-axis sota-gen-yAxis sota-num-axis").call(t.axisLeft(P).tickSize(-m));if(A.selectAll(".sota-columnChart-bar").data(M).join("rect").attr("class",(t,a)=>{let e="sota-columnChart-bar sota-gen-bar";return e+=d?" "+N(S[a]):"",e}).attr("x",(t,a)=>L(S[a])).attr("y",t=>P(t)).attr("width",L.bandwidth()).attr("height",t=>p-P(t)).call(l,k,n,S,G),d)p+=T;else if(I){let a=[];const e=W.select("text").node().getBBox(),n=e.y,l=e.height;W.selectAll("text").each((function(){a.push(this.getBBox().width)}));const s=t.max(a)*Math.sin(u*Math.PI/180),r=l*Math.cos(u*Math.PI/180);p+=n+s+r}else{let a=[];W.selectAll("text").each((function(){a.push(this.getBBox().y+this.getBBox().height)})),p+=+t.max(a)}let V=p+g.top+g.bottom;C.style("width",$+2*f+"px").attr("height",V).style("margin-left",-f),A.attr("transform",`translate(${g.left+f} ${g.top+T})`).attr("width",j)})},groupedBarChart:function({selector:e,dataFile:l,totalResp:s=null,inputIsPercentage:r=!1,displayPercentage:o=!0,minVal:i=0,maxVal:c=null,margin:h=a.margin}){const p=a.groupedBarChart.barHeight,d=a.groupedBarChart.barMargin,g=a.overflowOffset,f=a.groupLabelMargin,m=(a.swatch.between,a.swatch.right,a.swatch.width,a.swatch.height,a.swatch.belowBetween,a.swatch.below,a.xAxisTop),u=t.select(e).append("svg"),x=t.select("body").append("div").attr("class","tooltip"),b=u.append("g").attr("class","sota-mainChart"),y=document.querySelector(e).offsetWidth,w=y-h.left-h.right;t.csv(l+".csv").then(a=>{window.wow=a;const l=a.columns.splice(1),v=t.map(a,t=>t.group).keys(),B=t.map(a,a=>{let e=[];for(let t of l)e.push(+a[t]);return t.max(e)}).keys(),C=t.max(B,t=>+t);if(null==c)c=r||o?100:C;else if(isNaN(c)||""===c)throw"invalid maxVal for graph on "+e;const k=p+d,A=k*l.length;let $=(A+f)*a.length;const j=t.scaleLinear().domain([i,c]).range([0,w]),G=t.scaleOrdinal().domain(t.map(a,t=>t.group)).range(t.map(a,(t,a)=>(A+f)*a).keys()),S=t.scaleOrdinal().domain(l).range(t.map(l,(t,a)=>k*a).keys());b.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-groupedBarChart-xAxis sota-num-axis").call(t.axisBottom(j).tickSize(-($+m))).attr("transform","translate(0 "+($+m)+")");$+=20+m;const M=b.selectAll(".sota-groupedBarChart-group").data(a).join("g").attr("class","sota-groupedBarChart-group").attr("transform",(t,a)=>`translate(0 ${G(t.group)})`),L=t.scaleOrdinal().domain(l).range(t.map(l,(t,a)=>"module-fill-"+(a+1)).keys());M.selectAll(".sota-gen-bar").data(t=>{let a=[];for(let e of l)a.push(+t[e]);return a}).join("rect").attr("class",(t,a)=>"sota-gen-bar "+L(l[a])).attr("y",(t,a)=>+S(l[a])+ +f).attr("x",0).attr("width",(t,a)=>j(r?t:t/s[l[a]]*100)).attr("height",p).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),x.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"><span class="sota-heavy-label">${l[e]}</span><br/>Percentage: ${n(r?a:a/s[l[e]]*100)}`;return r||(t+="<br/>Number of responses: "+a),t+="</span>",t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{x.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),x.style("opacity",0)})),b.selectAll(".sota-gen-groupLabel").data(v).join("text").attr("class","sota-gen-groupLabel sota-text-label sota-heavy-label").text(t=>t).attr("alignment-baseline","bottom").attr("x",0).attr("y",t=>+G(t)+ +f).attr("transform","translate(0 -8)");let P=$+h.top+h.bottom;u.style("width",y+2*g+"px").attr("height",P).style("margin-left",-g),b.attr("transform",`translate(${h.left+g} ${h.top})`).attr("width",w)})},stackedColumnChart:function({selector:e,dataFile:l,inputIsPercentage:s=!1,displayPercentage:r=!0,maxVal:o=null,minVal:i=null,mainHeight:c=a.mainHeight,margin:h={top:20,bottom:20,left:24,right:0}}){const p=a.tickSize,d=a.separatorStrokeWidth,g=a.overflowOffset,f=a.swatch.between,m=a.swatch.right,u=a.swatch.width,x=a.swatch.height,b=a.swatch.belowBetween,y=a.swatch.below,w=t.select(e).append("svg"),v=t.select("body").append("div").attr("class","tooltip"),B=w.append("g").attr("class","sota-stackedColumnChart-mainChart"),C=document.querySelector(e).offsetWidth,k=C-h.left-h.right;t.csv(l+".csv").then(a=>{const l=a.columns.slice(1),A=t.map(a,t=>t.group).keys();var $=[];s?a.forEach(t=>{let a=0,e=[];for(let n of l){let l=+t[n];e.push([l,a]),a+=l}$.push(e)}):a.forEach(a=>{let e=0,n=t.sum(l,t=>+a[t]),s=[];for(let t of l){let l=+a[t]/n*100;s.push([l,e,+a[t]]),e+=l}$.push(s)});const j=r||s?$:a.map(t=>+t.value);if(null===i)i=s||r?0:t.min(j);else if(!0===i)i=t.min(j);else if(isNaN(i)||""===i)throw"invalid minVal for graph on "+e;if(null===o)o=s||r?100:t.max(j);else if(!0===o)o=t.max(j);else if(isNaN(o)||""===o)throw"invalid maxVal for graph on "+e;const G=t.scaleBand().domain(A).range([0,k]).padding([.3]),S=t.scaleLinear().domain([i,o]).range([c,0]),M=t.scaleOrdinal().domain(l).range(t.map(l,(t,a)=>"module-fill-"+(l.length>3?a+1:2*a+1)).keys()),L=(B.append("g").attr("class","sota-gen-axis sota-gen-yAxis sota-num-axis").call(t.axisLeft(S).tickSize(-p)),B.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-text-axis").call(t.axisBottom(G).ticks(a.length).tickSize(-p)).attr("transform","translate(0 "+c+")"));let P=0,N=[];const W=w.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${h.top})`);if(W.selectAll("nothing").data(l).enter().append("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(function(){N.push(this.getBBox().width)})).remove(),t.sum(N,t=>t)+N.length*f+(N.length-1)*m>k){let a=k-t.max(N)-u-f;W.selectAll(".sota-gen-legend-swatch").data(l).join("rect").attr("class",t=>"sota-gen-legend-swatch "+M(t)).attr("x",a).attr("y",(t,a)=>(x+b)*a).attr("width",u).attr("height",x),W.selectAll(".sota-gen-legend-text").data(l).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",a+u+f).attr("y",(t,a)=>(x+b)*a+x/2).attr("alignment-baseline","central"),P=l.length*x+(l.length-1)*b+y}else{let a=k-(t.sum(N,t=>t)+l.length*(u+f)+(l.length-1)*m);W.selectAll(".sota-gen-legend-swatch").data(l).join("rect").attr("class",t=>"sota-gen-legend-swatch "+M(t)).attr("x",(e,n)=>a+n*(u+f+m)+t.sum(N.slice(0,n),t=>t)).attr("y",0).attr("width",u).attr("height",x),W.selectAll(".sota-gen-legend-text").data(l).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(e,n)=>a+n*(u+f+m)+u+f+t.sum(N.slice(0,n),t=>t)).attr("y",x/2).attr("alignment-baseline","central"),P=x+y}const T=B.selectAll(".sota-stackedColumnChart-group").data($).join("g").attr("class","sota-stackedColumnChart-group").attr("transform",(t,a)=>"translate("+G(A[a])+" 0)");T.selectAll(".sota-stackedColumnChart-bar").data(t=>t).join("rect").attr("class",(t,a)=>"sota-stackedColumnChart-bar "+M(a)).attr("x",0).attr("y",t=>S(t[0]+t[1])).attr("width",G.bandwidth()).attr("height",t=>c-S(t[0])).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),v.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"><span class="sota-heavy-label">${l[e]}</span><br/>Percentage: ${n(a[0])}`;return s||(t+="<br/>Number of responses: "+a[2]),t+="</span>",t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{v.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),v.style("opacity",0)})),T.selectAll(".sota-stackedColumnChart-separator").data(t=>t).join("rect").attr("class","sota-stackedColumnChart-separator").attr("fill","white").attr("x",0).attr("y",(t,a)=>S(t[0])+S(t[1])-c).attr("height",t=>t[0]>0?d:0).attr("width",G.bandwidth()),c+=P;{let a=[];L.selectAll("text").each((function(){a.push(this.getBBox().y+this.getBBox().height)})),c+=+t.max(a)}let I=c+h.top+h.bottom+P;w.style("width",C+2*g+"px").attr("height",I).style("margin-left",-g),B.attr("transform",`translate(${h.left+g} ${h.top+P})`).attr("width",k)})},customColumnChart:function({selector:e,dataFile:n,shapeFile:r,shapeHeight:o=300,inputIsPercentage:i=!1,margin:c=a.margin}){const h=t.select(e).append("svg"),p=t.select("body").append("div").attr("class","tooltip"),d=h.append("g").attr("class","sota-mainChart"),g=document.querySelector(e).offsetWidth,f=a.separatorStrokeWidth;t.xml("shapes/"+r+".svg").then(a=>{let r=document.importNode(a.documentElement,!0),m=t.select(r).select("path").node(),u=0,x=0;h.append(()=>m).attr("class",(function(){return u=this.getBBox().width,x=this.getBBox().height,""})).remove();let b=o/x,y=u*b;h.append("defs").append("clipPath").attr("id","shapeDef"+e.substring(1)).append(()=>m).attr("transform",`scale(${b})`),t.csv(n+".csv").then(a=>{const[n,r,m]=s(a,i);let u=0,x=[];for(let t of a)x.push(u),u+=+t.value;const b=t.scaleLinear().domain([0,t.sum(a,t=>+t.value)]).range([0,o]),w=t.scaleOrdinal().domain(m).range(t.map(m,(t,a)=>"module-fill-"+(a+1)).keys());d.selectAll(".sota-customColumnChart-bar").data(a).join("rect").attr("class",t=>"sota-customColumnChart-bar "+w(t.label)).attr("x",0).attr("y",(t,a)=>b(x[a])).attr("width",y).attr("height",t=>b(t.value)).attr("clip-path","url(#shapeDef"+e.substring(1)+")").call(l,p,n,m,r),d.selectAll(".sota-customColumnChart-separator").data(a).join("rect").attr("class","sota-customColumnChart-separator").attr("x",0).attr("y",(t,a)=>0==a?-f:b(x[a])).attr("width",y).attr("height",f).attr("fill","white").attr("clip-path","url(#shapeDef"+e.substring(1)+")");const v=o+c.top+c.bottom;h.attr("height",v),d.attr("transform",`translate(${c.left} ${c.top})`).attr("width",g-c.left-c.right)})})},setColors:function(t){let a="";for(const e in t){a+=`#${e}{\n            background-color: ${t[e][0]};\n            color: ${t[e][0]};\n            }\n            #${e} .sota-gen-bar{\n                fill: ${t[e][3]};\n            }\n            `;for(const n in t[e])a+=`\n            #${e} .module-fill-${+n+1}{\n                fill: ${t[e][n]};\n            }\n            `}document.head.appendChild(document.createElement("style")).textContent=a},setStyles:function(t,e=a){const n=e.separatorStrokeWidth,l=e.lineColor;let s=`\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 700;\n\tsrc: url("${t}/Gotham/GothamBold.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 700;\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamBoldItalic.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tsrc: url("${t}/Gotham/GothamBook.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamBookItalic.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 300;\n\tsrc: url("${t}/Gotham/GothamLight.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 300;\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamLightItalic.ttf")\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Roman.otf");\n\tfont-weight: normal;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Italic.otf");\n\tfont-weight: normal;\n\tfont-style: italic\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Bold.otf");\n\tfont-weight: bold;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-BoldItalic.otf");\n\tfont-weight: bold;\n\tfont-style: italic\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Semibold.otf");\n\tfont-weight: 600;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-SemiboldItalic.otf");\n\tfont-weight: 600;\n\tfont-style: italic\n}\n\nbody{\n    margin: 0;\n}\n\nsection {\n\tpadding: 48px 0;\n\twidth: 100%\n}\n\nh1 {\n\tfont-size: 56px;\n\tfont-family: 'Gotham', sans-serif;\n\ttext-transform: uppercase;\n\tfont-weight: 700;\n\ttext-align: center;\n\tcolor: #fff\n}\n\n.container {\n    position: relative;\n\tmax-width: 1500px;\n\tbox-sizing: border-box;\n\tfont-family: "Gotham", Arial, sans-serif;\n\twidth: 100%;\n\tpadding: 48px 24px;\n\tmargin: 0 auto;\n\tdisplay: grid;\n\tcolumn-gap: 48px;\n\tbackground-color: #fff;\n\tgrid-template-columns: minmax(0, 1fr)\n}\n\n.container:before, .container:after{\n    pointer-events: none;\n    content: "";\n    position: absolute;\n    left: 0;\n    top: 32px;\n    height: calc(100% - 64px);\n    border-right: 1px solid rgba(0,0,0,0.1);\n    display: none;\n}\n\n.container .module-two-wide {\n\tgrid-column: 1/3\n}\n\n@media (min-width: 800px) {\n\t.container {\n\t\tgrid-template-columns: repeat(2, minmax(0, 1fr))\n\t}\n\n    .container:before{\n      width: 50%;\n      display: block;\n    }\n}\n\n@media (min-width: 1200px) {\n\t.container {\n\t\tgrid-template-columns: repeat(3, minmax(0, 1fr))\n\t}\n\n    .container:before{\n      width: 33.3%;\n    }\n    \n    .container:after{\n      width: 66.6%;\n      display: block;\n    }\n}\n\n.module {\n\tposition: relative;\n\twidth: 100%;\n\tborder-bottom: 1px solid rgba(0,0,0,0.2);\n\tmargin-bottom: 32px;\n}\n\n.module>svg {\n\twidth: 100%\n}\n\n.module h3 {\n\tfont-family: 'Gotham', sans-serif;\n\tfont-weight: 700;\n\ttext-transform: uppercase\n}\n\n.module .subtitle {\n\tfont-family: "Mercury Text G1", serif;\n\topacity: 0.4\n}\n\ntext{\n    fill: red;\n}\n\n.sota-heavy-label{\n    font-weight: 700;\n}\n\n.sota-num-label, .sota-num-axis .tick text{\n    font-family: "Gotham", sans-serif;\n    font-size: 14px;\n    fill: ${a.labelColor};\n}\n\n.sota-text-label, .sota-text-axis .tick text{\n    font-family: "Mercury Text G1", serif;\n    fill: black;\n}\n\n.sota-num-label.sota-stackedBarChart-label-onBar{\n    fill: rgba(255,255,255,0.6);\n}\n\n.tooltip {\n\tbackground-color: #222;\n\tcolor: #fff;\n\tpadding: 12px;\n\tposition: absolute;\n\tpointer-events: none;\n\topacity: 0;\n\ttransform: translate(-50%, -100%);\n\twhite-space: nowrap\n}\n\n.sota-gen-axis{\n    opacity: 0.4;\n}\n\n.sota-gen-axis.sota-gen-xAxis .tick text {\n\ttransform: translateY(4px);\n}\n\n.sota-gen-axis.sota-gen-yAxis .tick text {\n\ttransform: translateX(-8px);\n\ttext-anchor: end\n}\n\n.sota-gen-xAxis:not(.sota-text-axis) g.tick:first-of-type text:not(.angled-label){\n    text-anchor: start;\n}\n\n.sota-gen-xAxis:not(.sota-text-axis) g.tick:last-of-type text:not(.angled-label){\n    text-anchor: end;\n}\n\n.sota-gen-axis .tick line,\n.sota-gen-axis path.domain {\n\tstroke-width: ${n}px;\n\tstroke: ${l};\n}\n\n.sota-groupedBarChart-xAxis .tick line {\n\topacity: 0.2\n}\n\n.sota-big {\n\tfont-weight: 700;\n\tfont-size: 96px;\n\tline-height: 1.0;\n\tmargin-top: -8px;\n\tfont-family: "Mercury Text G1", serif\n}\n    `;document.head.appendChild(document.createElement("style")).textContent=s}};return i.sotaConfig=a,i.setParam=function(t,a){this.sotaConfig[t]=a},i.getParam=function(t){return this.sotaConfig[t]},i}));
