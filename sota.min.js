!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("d3")):"function"==typeof define&&define.amd?define(["d3"],a):(t=t||self).sota=a(t.d3)}(this,(function(t){"use strict";var a={separatorStrokeWidth:1,barHeight:32,barMargin:16,labelLeft:6,labelBelow:8,groupLabelMargin:32,legendMargin:24,xAxisTop:24,overflowOffset:24,lineColor:"#777777",labelColor:"#777777",mainHeight:300,tickSize:4,labelAngle:30,groupedBarChart:{barHeight:24,barMargin:8},margin:{top:20,bottom:20,left:0,right:0},swatch:{between:12,belowBetween:8,right:24,width:32,height:24,below:16}};function e(a){const e=a.node().offsetWidth/2,n=t.event.pageX;return n-e<0?e:n+e>window.innerWidth?window.innerWidth-e:n}function n(a){return t.format(".1f")(a)+"%"}function l(l,s,r,o,i){l.on("mouseover",(function(l,c){t.select(this).attr("opacity",a.hoverOpacity),s.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"></span><span class="sota-heavy-label">${o[c]}</span><br/>Percentage: ${n(r[c])}`;return i&&(t+="<br/>Number of responses: "+i[c]),t+="</span>",t}).style("left",e(s)+"px").style("top",t.event.pageY+"px")})).on("mousemove",a=>{s.style("left",e(s)+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),s.style("opacity",0)}))}function s(a,e,n=null){return n=null==n?t.sum(a,t=>+t.value):n,[e?a.map(t=>+t.value).keys:a.map(t=>+t.value/n*100),!e&&a.map(t=>+t.value),a.map(t=>t.label)]}let r={barChart:function({selector:e,dataFile:r,inputIsPercentage:o=!1,showXAxis:i=!0,showSeparators:c=!0,displayPercentage:h=!0,totalResp:d=null,maxVal:g=null,minVal:p=null,margin:f=a.margin}){const m=a.tickSize,u=a.separatorStrokeWidth,x=a.labelLeft,b=a.barHeight,y=a.barMargin,w=a.overflowOffset,v=a.xAxisTop,B=t.select(e).append("svg"),C=t.select("body").append("div").attr("class","tooltip"),k=document.querySelector(e).offsetWidth,A=k-f.left-f.right,$=B.append("g").attr("class","sota-barChart-mainChart").attr("transform",`translate(${f.left+w} ${f.right})`).attr("width",A);t.csv(r+".csv").then(a=>{const r=b+y;let M=a.length*r;const[j,G,S]=s(a,o,d),L=h||o?j:G;if(null==p)p=o||h?0:t.min(L);else if(!0===p)p=t.min(L);else if(isNaN(p)||""===p)throw"invalid minVal for graph on "+e;if(null==g)g=o||h?100:t.max(L);else if(!0===g)g=t.max(L);else if(isNaN(g)||""===g)throw"invalid maxVal for graph on "+e;const P=t.scaleLinear().domain([p,g]).range([0,A]);let N;function W(t){return t*r}if(i&&(N=$.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-num-axis").call(t.axisBottom(P).tickSize(-m)).attr("transform","translate(0 "+(M+v)+")")),$.selectAll(".sota-barChart-bar").data(L).join("rect").attr("class","sota-barChart-bar sota-gen-bar").attr("width",t=>P(t)).attr("height",b).attr("x",0).attr("y",(t,a)=>W(a)),$.selectAll(".sota-barChart-hiddenBar").data(L).join("rect").attr("class","sota-barChart-hiddenBar").attr("width",A).attr("height",b).attr("x",0).attr("y",(t,a)=>W(a)).attr("fill","transparent").call(l,C,j,S,G),$.selectAll(".sota-barChart-label").data(a).join("text").attr("class","sota-barChart-label sota-text-label sota-heavy-label").html(t=>t.label).attr("alignment-baseline","central").attr("x",x).attr("y",(t,a)=>W(a)+b/2),c&&$.selectAll(".sota-barChart-separator").data(L).join("line").attr("class","sota-barChart-separator").attr("x1",0).attr("x2",A).attr("y1",(t,a)=>W(a)+b+6).attr("y2",(t,a)=>W(a)+b+6).attr("stroke-width",u).attr("stroke","#dddddd"),$.selectAll(".sota-barChart-value").data(L).join("text").attr("class","sota-barChart-value sota-num-label").html((t,a)=>o||h?n(t):t).attr("alignment-baseline","central").attr("text-anchor","end").attr("x",A).attr("y",(t,a)=>W(a)+b/2),i){let a=[];N.selectAll("text").each((function(){a.push(this.getBBox().y+this.getBBox().height)})),M+=+t.max(a)}const I=M+f.top+f.bottom;B.style("width",k+2*w+"px").attr("height",I).style("margin-left",-w)})},pieChart:function({selector:e,dataFile:r,inputIsPercentage:o=!1,pieRad:i=150,pieThick:c=80,margin:h=a.margin}){const d=a.lineColor,g=a.separatorStrokeWidth,p=a.separatorStrokeWidth,f=a.swatch.between,m=a.swatch.right,u=a.swatch.width,x=a.swatch.height,b=a.swatch.belowBetween,y=a.swatch.below,w=a.legendMargin,v=a.overflowOffset,B=t.select(e),C=B.append("svg"),k=t.select("body").append("div").attr("class","tooltip"),A=B.node().offsetWidth,$=A-h.left-h.right,M=C.append("g").attr("class","sota-barChart-mainChart").attr("transform",`translate(${h.left+v} ${h.right})`).attr("width",$);$<2*i&&(i=$/2),c>i&&(c=50),h.top,h.bottom,t.csv(r+".csv").then(a=>{const[e,r,B]=s(a,o),j=e.sort((t,a)=>a-t),G=r.sort((t,a)=>a-t),S=t.pie()(j).sort((t,a)=>a.value-t.value);let L=0,P=[];const N=t.scaleOrdinal().domain(B).range(t.map(B,(t,a)=>"module-fill-"+(B.length>3?a+1:2*a+1)).keys()),W=M.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${h.top})`);if(W.selectAll("nothing").data(a).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t.label).attr("x",(function(){P.push(this.getBBox().width)})).remove(),t.sum(P,t=>t)+3*f+2*m>$){let a=$-t.max(P)-u-f;W.selectAll(".sota-gen-legend-swatch").data(B).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",a).attr("y",(t,a)=>(x+b)*a).attr("width",u).attr("height",x),W.selectAll(".sota-gen-legend-text").data(B).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",a+u+f).attr("y",(t,a)=>(x+b)*a+x/2).attr("alignment-baseline","central"),L=B.length*x+(B.length-1)*b+y+w}else{let a=$-(t.sum(P,t=>t)+B.length*(u+f)+(B.length-1)*m);W.selectAll(".sota-gen-legend-swatch").data(B).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",(e,n)=>a+n*(u+f+m)+t.sum(P.slice(0,n),t=>t)).attr("y",0).attr("width",u).attr("height",x),W.selectAll(".sota-gen-legend-text").data(B).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(e,n)=>a+n*(u+f+m)+u+f+t.sum(P.slice(0,n),t=>t)).attr("y",x/2).attr("alignment-baseline","central"),L=x+y+w}const I=M.append("g").attr("transform","translate("+$/2+","+(i+L)+")"),T=t.arc().innerRadius(.8*i-.8*c).outerRadius(.8*i),V=t.arc().innerRadius(.9*i).outerRadius(.9*i);I.selectAll(".sota-pieChart-slice").data(S).join("path").attr("class",(t,a)=>"sota-pieChart-slice "+N(a)).attr("d",T).attr("stroke","#fff").style("stroke-width",p).call(l,k,j,B,G);let z=!1;I.selectAll(".sota-pieChart-polyline").data(S).join("polyline").attr("class","sota-pieChart-polyline").attr("stroke",d).style("fill","none").attr("stroke-width",g).attr("points",(t,a)=>{let e=T.centroid(t),n=V.centroid(t),l=V.centroid(t);const s=V.centroid(t),r=a>0&&V.centroid(S[a-1]),o=(t.endAngle+t.startAngle)/2<Math.PI;return a>0&&Math.sign(s[0])==Math.sign(r[0])&&Math.abs(r[1]-s[1])<20?(l[0]=.95*i*((z?o:!o)?1:-1),z=!0):(l[0]=.95*i*((z?!o:o)?1:-1),z=!1),[e,n,l]}),z=!1,I.selectAll(".sota-pieChart-label").data(S).join("text").attr("class","sota-pieChart-label sota-num-label").text((t,a)=>n(j[a])).attr("alignment-baseline","central").attr("transform",(t,a)=>{const e=V.centroid(t),n=a>0&&V.centroid(S[a-1]),l=(t.endAngle+t.startAngle)/2<Math.PI;return a>0&&Math.sign(e[0])==Math.sign(n[0])&&Math.abs(n[1]-e[1])<20?(e[0]=.99*i*((z?l:!l)?1:-1),z=!0,console.log("overlap")):(e[0]=.99*i*((z?!l:l)?1:-1),z=!1),a==S.length-1&&(z=!1),"translate("+e+")"}).style("text-anchor",(t,a)=>{const e=V.centroid(t),n=a>0&&V.centroid(S[a-1]),l=(t.endAngle+t.startAngle)/2<Math.PI;if(a>0&&Math.sign(e[0])==Math.sign(n[0])&&Math.abs(n[1]-e[1])<20){const t=(z?l:!l)?"start":"end";return z=!0,t}{const t=(z?!l:l)?"start":"end";return z=!1,t}});const O=2*i+L+h.top+h.bottom;C.style("width",A+2*v+"px").attr("height",O).style("margin-left",-v)})},lineGraph:function({selector:e,dataFile:l,inputIsPercentage:s=!1,minVal:r=null,maxVal:o=null,height:i=300,customTooltipAppend:c="",prop5:h="value5",prop6:d="value6",margin:g={top:20,bottom:20,left:24,right:0}}){const p=t.select(e).append("svg").attr("class","sota-lineGraph"),f=t.select("body").append("div").attr("class","tooltip"),m=document.querySelector(e).offsetWidth;p.attr("height",i),t.csv(l+".csv").then(l=>{const c=a.separatorStrokeWidth,h=l.map(t=>t.label),d=l.map(t=>+t.value);if(null==r)r=s?0:t.min(l,t=>t.value);else if(1==r)r=t.min(l,t=>t.value);else if(isNaN(r)||""==r)throw"invalid minVal for graph on "+e;if(null==o)o=s?100:t.max(l,t=>t.value);else if(1==o)o=t.max(l,t=>t.value);else if(isNaN(o)||""==o)throw"invalid maxVal for graph on "+e;const u=t.scaleBand().domain(h.map(t=>t)).range([g.left,m-g.right]),x=t.scaleLinear().domain([r,o]).range([i-g.bottom,g.top]);p.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-text-axis").call(t.axisBottom(u).ticks(l.length).tickSize(-8)).style("transform","translateY("+(i-g.bottom)+"px)"),p.append("g").attr("class","sota-gen-axis sota-gen-YAxis sota-num-axis").call(t.axisLeft(x).tickSize(-8)).style("transform","translateX("+g.left+"px)"),p.selectAll(".sota-lineGraph-path").data([d]).join("path").attr("class","sota-lineGraph-path").attr("d",t.line().x((t,a)=>u(h[a])+u.bandwidth()/2).y(t=>x(t))).attr("fill","none").attr("stroke","#bbb").style("stroke-width",3),p.selectAll(".sota-lineGraph-circle").data(d).join("circle").attr("class","sota-lineGraph-circle").attr("cx",(t,a)=>u(h[a])+u.bandwidth()/2).attr("cy",t=>x(t)).attr("r",9).attr("stroke","white").style("stroke-width",c).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),f.style("opacity",1).html(`<span class="sota-tooltip-label">${h[e]}</span><br/>Value: `+(s?n(a):a)+"</span>").style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",a=>{f.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),f.style("opacity",0)})),p.selectAll(".sota-lineGraph-label").data(d).join("text").attr("class","sota-lineGraph-label sota-num-label").text((t,a)=>{if(s)return t+"%"}).attr("x",(t,a)=>u(h[a])+u.bandwidth()/2).attr("y",t=>x(t)-16).style("text-anchor","middle")})},stackedBarChart:function({selector:e,dataFile:l,inputIsPercentage:s=!1,showXAxis:r=!0,labelStyle:o="onBar",groupLabelStyle:i="none",showLegend:c=!0,prop5:h="value5",prop6:d="value6",margin:g=a.margin}){const p=a.separatorStrokeWidth,f=a.barHeight,m=a.barMargin,u=a.overflowOffset,x=a.groupLabelMargin,b=a.labelLeft,y=a.labelBelow,w=a.lineColor,v=a.swatch.between,B=a.swatch.right,C=a.swatch.width,k=a.swatch.height,A=a.swatch.belowBetween,$=a.swatch.below,M=a.xAxisTop;var j=t.select(e).append("svg"),G=t.select("body").append("div").attr("class","tooltip"),S=document.querySelector(e).offsetWidth,L=S-g.left-g.right;const P=j.append("g").attr("class","sota-stackedBarChart-mainChart").attr("transform",`translate(${g.left+u} ${g.right})`).attr("width",L);t.csv(l+".csv").then(a=>{var e=f+m,l=a.length*e,h=0;"onBar"==i&&(e+=a.length*x,l+=a.length*x,h=x);const d=a.columns.slice(1),N=t.map(a,t=>t.group).keys();var W=[];s?a.forEach(t=>{let a=0,e=[];for(let n of d){let l=+t[n];e.push([l,a]),a+=l}W.push(e)}):a.forEach(a=>{let e=0,n=t.sum(d,t=>+a[t]),l=[];for(let t of d){let s=+a[t]/n*100;l.push([s,e,+a[t]]),e+=s}W.push(l)});const I=t.scaleBand().domain(N).range([0,l]).padding([.2]),T=t.scaleLinear().domain([0,100]).range([0,L]),V=t.scaleOrdinal().domain(d).range(t.map(d,(t,a)=>"module-fill-"+(d.length>3?a+1:2*a+1)).keys());r&&(P.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-num-axis").call(t.axisBottom(T).ticks(a.length).tickSize(-8)).attr("transform","translate(0 "+(l+M)+")"),l+=20+M);var z=0;if(c){let a=[];const e=j.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${g.top})`);if(e.selectAll("nothing").data(d).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(function(){a.push(this.getBBox().width)})).remove(),t.sum(a,t=>t)+3*v+2*B>L){let n=L-t.max(a)-C-v;e.selectAll(".sota-gen-legend-swatch").data(d).join("rect").attr("class",t=>"sota-gen-legend-swatch "+V(t)).attr("x",n).attr("y",(t,a)=>(k+A)*a).attr("width",C).attr("height",k),e.selectAll(".sota-gen-legend-text").data(d).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",n+C+v).attr("y",(t,a)=>(k+A)*a+k/2).attr("alignment-baseline","central"),z=d.length*k+(d.length-1)*A+$}else{let n=L-(t.sum(a,t=>t)+d.length*(C+v)+(d.length-1)*B);e.selectAll(".sota-gen-legend-swatch").data(d).join("rect").attr("class",t=>"sota-gen-legend-swatch "+V(t)).attr("x",(e,l)=>n+l*(C+v+B)+t.sum(a.slice(0,l),t=>t)).attr("y",0).attr("width",C).attr("height",k),e.selectAll(".sota-gen-legend-text").data(d).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(e,l)=>n+l*(C+v+B)+C+v+t.sum(a.slice(0,l),t=>t)).attr("y",k/2).attr("alignment-baseline","central"),z=k+$}}const O=P.selectAll(".sota-stackedBarChart-group").data(W).join("g").attr("class","sota-stackedBarChart-group").attr("transform",(t,a)=>"translate(0 "+(I(N[a])+h-m)+")");O.selectAll(".sota-stackedBarChart-bar").data(t=>t).join("rect").attr("class",(t,a)=>"sota-stackedBarChart-bar "+V(a)).attr("x",t=>T(t[1])).attr("y",0).attr("width",t=>T(t[0])).attr("height",f).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),G.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"><span class="sota-heavy-label">${d[e]}</span><br/>Percentage: ${n(a[0])}`;return s||(t+="<br/>Number of responses: "+a[2]),t+="</span>",t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{G.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),G.style("opacity",0)})),O.selectAll(".sota-stackedBarChart-separator").data(t=>t).join("rect").attr("class","sota-stackedBarChart-separator").attr("fill","white").attr("x",t=>T(t[1])+T(t[0])).attr("y",0).attr("width",t=>t[0]>0?p:0).attr("height",f),"onBar"==i&&P.selectAll(".sota-stackedBarChart-groupLabel-onBar").data(N).join("text").attr("class","sota-stackedBarChart-groupLabel-onBar sota-text-label sota-heavy-label").text(t=>t).attr("alignment-baseline","bottom").attr("x",0).attr("y",t=>I(t));var Y=0;if("onBar"==o)O.selectAll(".sota-stackedBarChart-label-onBar").data(t=>t).join("text").attr("class","sota-stackedBarChart-label-onBar sota-num-label").text(a=>t.format(".1f")(a[0])+"%").attr("alignment-baseline","central").attr("text-anchor","end").attr("x",t=>T(t[1])+T(t[0])-b).attr("y",f/2).style("display",(function(t,a){return this.getBBox().x<(a>0?T(t[1]):g.left)?"none":""}));else if("aboveBar"==o){var X=[];O.selectAll(".sota-stackedBarChart-label-aboveBar-text").data(t=>t).join("text").attr("class","sota-stackedBarChart-label-aboveBar-text sota-num-label").text((a,e)=>`${d[e]}: ${t.format(".1f")(a[0])}%`).attr("x",t=>T(t[1])+T(t[0])/2).attr("y",(function(t){return X.push([this.getBBox().x,this.getBBox().width]),-2*y})).attr("alignment-baseline","bottom");let a=[];!function t(e){if(e==X.length-1)return a[e]=-2,-2;if(X[e][0]+X[e][1]+b>X[e+1][0]){X[e+1][0]=X[e][0]+X[e][1]+b;let n=t(e+1)-1;return a[e]=n,n}return t(e+1),a[e]=-2,-2}(0),O.selectAll(".sota-stackedBarChart-label-aboveBar-line").data(t=>t).join("polyline").attr("class","sota-stackedBarChart-label-aboveBar-line").attr("points",(t,e)=>{let n=T(t[1])+T(t[0])/2,l=f/2,s=n,r=(a[e]+1)*y;return`${n},${l} ${s},${r} ${X[e][0]+X[e][1]},${r}`}).attr("stroke-width",p).attr("stroke",w).attr("fill","none"),O.selectAll(".sota-stackedBarChart-label-aboveBar-text").data(t=>t).join("text").attr("x",(t,a)=>X[a][0]).attr("y",(t,e)=>a[e]*y),Y=-1*t.min(a)*y+20}const F=l+g.top+g.bottom+z+Y;j.style("width",S+2*u+"px").attr("height",F).style("margin-left",-u),P.attr("transform",`translate(${u} ${g.top+z+Y})`).attr("width",L)})},customBarChart:function({selector:e,dataFile:r,shapeFile:o,shapeWidth:i=300,inputIsPercentage:c=!1,margin:h=a.margin}){var d=t.select(e).append("svg"),g=t.select("body").append("div").attr("class","tooltip");const p=d.append("g").attr("class","sota-mainChart");var f=document.querySelector(e).offsetWidth;const m=a.separatorStrokeWidth,u=a.labelLeft,x=a.labelBelow,b=a.lineColor;t.xml("shapes/"+o+".svg").then(a=>{let o=document.importNode(a.documentElement,!0),y=t.select(o).select("path").node(),w=0,v=0;d.append(()=>y).attr("class",(function(){return w=this.getBBox().width,v=this.getBBox().height,""})).remove();let B=i/w,C=v*B;d.append("defs").append("clipPath").attr("id","shapeDef"+e.substring(1)).append(()=>y).attr("transform",`scale(${B})`),t.csv(r+".csv").then(a=>{const[r,o,y]=s(a,c);let w=0,v=[];for(let t of a)v.push(w),w+=+t.value;const B=t.scaleLinear().domain([0,t.sum(a,t=>+t.value)]).range([0,i]),k=t.scaleOrdinal().domain(t.map(a,t=>t.label)).range(t.map(a,(t,a)=>"module-fill-"+(a+1)).keys());p.selectAll(".sota-customBarChart-bar").data(a).join("rect").attr("class",t=>"sota-customBarChart-bar "+k(t.label)).attr("x",(t,a)=>B(v[a])).attr("y",0).attr("width",t=>B(t.value)).attr("height",C).attr("clip-path","url(#shapeDef"+e.substring(1)+")").call(l,g,r,y,o),p.selectAll(".sota-customBarChart-separator").data(a).join("rect").attr("class","sota-customBarChart-separator").attr("x",(t,a)=>0==a?-m:B(v[a])).attr("y",0).attr("width",m).attr("height",C).attr("fill","white").attr("clip-path","url(#shapeDef"+e.substring(1)+")");var A=[];p.selectAll(".sota-customBarChart-label-aboveBar-text").data(a).join("text").attr("class","sota-customBarChart-label-aboveBar-text").html((t,a)=>`<tspan class="sota-text-label sota-heavy-label">${t.label}:</tspan><tspan class="sota-num-label"> ${n(r[a])}</tspan>`).attr("x",(t,a)=>B(v[a])+B(t.value)/2+u).attr("y",(function(t){return A.push([this.getBBox().x,this.getBBox().width]),C+3*x})).attr("alignment-baseline","top");let $=[];!function t(a){if(a==A.length-1)return $[a]=3,3;if(A[a][0]+A[a][1]+2*u>A[a+1][0]){A[a+1][0]=A[a][0]+A[a][1]+2*u;let e=t(a+1)+1;return $[a]=e,e}return t(a+1),$[a]=3,3}(0),p.selectAll(".sota-customBarChart-label-aboveBar-line").data(a).join("polyline").attr("class","sota-customBarChart-label-aboveBar-line").attr("points",(t,a)=>{let e=B(v[a])+B(t.value)/2,n=C-x,l=e,s=C+($[a]+1)*x;return`${e},${n} ${l},${s} ${A[a][0]+A[a][1]},${s}`}).attr("stroke-width",m).attr("stroke",b).attr("fill","none"),p.selectAll(".sota-customBarChart-label-aboveBar-text").data(a).join("text").attr("x",(t,a)=>A[a][0]).attr("y",(t,a)=>C+$[a]*x);let M=t.max($)*x+20,j=C+h.top+h.bottom+M;d.attr("height",j),p.attr("transform",`translate(${h.left} ${h.top})`).attr("width",f-h.left-h.right)})})},columnChart:function({selector:e,dataFile:n,inputIsPercentage:r=!1,displayPercentage:o=!0,totalResp:i=null,maxVal:c=null,minVal:h=null,mainHeight:d=a.mainHeight,showLegend:g=!1,margin:p={top:20,bottom:20,left:24,right:0}}){const f=a.overflowOffset,m=a.tickSize,u=a.labelAngle,x=a.swatch.between,b=a.swatch.right,y=a.swatch.width,w=a.swatch.height,v=a.swatch.belowBetween,B=a.swatch.below,C=t.select(e).append("svg"),k=t.select("body").append("div").attr("class","tooltip"),A=C.append("g").attr("class","sota-mainChart"),$=document.querySelector(e).offsetWidth,M=$-p.left-p.right;t.csv(n+".csv").then(a=>{const[n,j,G]=s(a,r,i),S=o||r?n:j;if(null===h)h=r||o?0:t.min(S);else if(!0===h)h=t.min(S);else if(isNaN(h)||""===h)throw"invalid minVal for graph on "+e;if(null===c)c=r||o?100:t.max(S);else if(!0===c)c=t.max(S);else if(isNaN(c)||""===c)throw"invalid maxVal for graph on "+e;const L=t.scaleBand().domain(G).range([0,M]).padding([.3]),P=t.scaleLinear().domain([h,c]).range([d,0]),N=t.scaleOrdinal().domain(G).range(t.map(G,(t,a)=>"module-fill-"+(a+1)).keys());let W,I=0,T=!1;if(g){let e=[];const n=C.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${p.top})`);if(n.selectAll("nothing").data(a).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t.label).attr("x",(function(){e.push(this.getBBox().width)})).remove(),t.sum(e,t=>t)+e.length*x+(e.length-1)*b>M){let a=M-t.max(e)-y-x;n.selectAll(".sota-gen-legend-swatch").data(G).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",a).attr("y",(t,a)=>(w+v)*a).attr("width",y).attr("height",w),n.selectAll(".sota-gen-legend-text").data(G).join("text").attr("class","sota-gen-legend-text sota-text-label").text(t=>t).attr("x",a+y+x).attr("y",(t,a)=>(w+v)*a+w/2).attr("alignment-baseline","central"),I=G.length*w+(G.length-1)*v+B}else{let a=M-(t.sum(e,t=>t)+G.length*(y+x)+(G.length-1)*b);n.selectAll(".sota-gen-legend-swatch").data(G).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",(n,l)=>a+l*(y+x+b)+t.sum(e.slice(0,l),t=>t)).attr("y",0).attr("width",y).attr("height",w),n.selectAll(".sota-gen-legend-text").data(G).join("text").attr("class","sota-gen-legend-text sota-text-label").text(t=>t).attr("x",(n,l)=>a+l*(y+x+b)+y+x+t.sum(e.slice(0,l),t=>t)).attr("y",w/2).attr("alignment-baseline","central"),I=w+B}}else{W=A.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-text-axis").call(t.axisBottom(L).tickSize(0)).attr("transform",`translate(0 ${d})`);const a=W.selectAll("text"),e=a.nodes();for(let t in e){if(t==e.length-1)continue;let a=e[+t].getBBox(),n=e[+t+1].getBBox();if(a.x+a.width>n.x){T=!0;break}}T&&a.attr("text-anchor","end").style("transform",`translateY(4px) rotate(-${u}deg)`).node().classList.add("angled-label")}A.append("g").attr("class","sota-gen-axis sota-gen-yAxis sota-num-axis").call(t.axisLeft(P).tickSize(-m));if(A.selectAll(".sota-columnChart-bar").data(S).join("rect").attr("class",(t,a)=>{let e="sota-columnChart-bar sota-gen-bar";return e+=g?" "+N(G[a]):"",e}).attr("x",(t,a)=>L(G[a])).attr("y",t=>P(t)).attr("width",L.bandwidth()).attr("height",t=>d-P(t)).call(l,k,n,G,j),g)d+=I;else if(T){let a=[];const e=W.select("text").node().getBBox(),n=e.y,l=e.height;W.selectAll("text").each((function(){a.push(this.getBBox().width)}));const s=t.max(a)*Math.sin(u*Math.PI/180),r=l*Math.cos(u*Math.PI/180);d+=n+s+r}else{let a=[];W.selectAll("text").each((function(){a.push(this.getBBox().y+this.getBBox().height)})),d+=+t.max(a)}let V=d+p.top+p.bottom;C.style("width",$+2*f+"px").attr("height",V).style("margin-left",-f),A.attr("transform",`translate(${p.left+f} ${p.top+I})`).attr("width",M)})},groupedBarChart:function({selector:e,dataFile:l,totalResp:s=null,inputIsPercentage:r=!1,displayPercentage:o=!0,minVal:i=0,maxVal:c=null,margin:h=a.margin}){const d=a.groupedBarChart.barHeight,g=a.groupedBarChart.barMargin,p=a.overflowOffset,f=a.groupLabelMargin,m=(a.swatch.between,a.swatch.right,a.swatch.width,a.swatch.height,a.swatch.belowBetween,a.swatch.below,a.xAxisTop),u=t.select(e).append("svg"),x=t.select("body").append("div").attr("class","tooltip"),b=u.append("g").attr("class","sota-mainChart"),y=document.querySelector(e).offsetWidth,w=y-h.left-h.right;t.csv(l+".csv").then(a=>{window.wow=a;const l=a.columns.splice(1),v=t.map(a,t=>t.group).keys(),B=t.map(a,a=>{let e=[];for(let t of l)e.push(+a[t]);return t.max(e)}).keys(),C=t.max(B,t=>+t);if(null==c)c=r||o?100:C;else if(isNaN(c)||""===c)throw"invalid maxVal for graph on "+e;const k=d+g,A=k*l.length;let $=(A+f)*a.length;const M=t.scaleLinear().domain([i,c]).range([0,w]),j=t.scaleOrdinal().domain(t.map(a,t=>t.group)).range(t.map(a,(t,a)=>(A+f)*a).keys()),G=t.scaleOrdinal().domain(l).range(t.map(l,(t,a)=>k*a).keys());b.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-groupedBarChart-xAxis sota-num-axis").call(t.axisBottom(M).tickSize(-($+m))).attr("transform","translate(0 "+($+m)+")");$+=20+m;const S=b.selectAll(".sota-groupedBarChart-group").data(a).join("g").attr("class","sota-groupedBarChart-group").attr("transform",(t,a)=>`translate(0 ${j(t.group)})`),L=t.scaleOrdinal().domain(l).range(t.map(l,(t,a)=>"module-fill-"+(a+1)).keys());S.selectAll(".sota-gen-bar").data(t=>{let a=[];for(let e of l)a.push(+t[e]);return a}).join("rect").attr("class",(t,a)=>"sota-gen-bar "+L(l[a])).attr("y",(t,a)=>+G(l[a])+ +f).attr("x",0).attr("width",(t,a)=>M(r?t:t/s[l[a]]*100)).attr("height",d).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),x.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"><span class="sota-heavy-label">${l[e]}</span><br/>Percentage: ${n(r?a:a/s[l[e]]*100)}`;return r||(t+="<br/>Number of responses: "+a),t+="</span>",t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{x.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),x.style("opacity",0)})),b.selectAll(".sota-gen-groupLabel").data(v).join("text").attr("class","sota-gen-groupLabel sota-text-label sota-heavy-label").text(t=>t).attr("alignment-baseline","bottom").attr("x",0).attr("y",t=>+j(t)+ +f).attr("transform","translate(0 -8)");let P=$+h.top+h.bottom;u.style("width",y+2*p+"px").attr("height",P).style("margin-left",-p),b.attr("transform",`translate(${h.left+p} ${h.top})`).attr("width",w)})},stackedColumnChart:function({selector:e,dataFile:l,inputIsPercentage:s=!1,displayPercentage:r=!0,maxVal:o=null,minVal:i=null,mainHeight:c=a.mainHeight,margin:h={top:20,bottom:20,left:24,right:0}}){const d=a.tickSize,g=a.separatorStrokeWidth,p=a.overflowOffset,f=a.labelAngle,m=a.swatch.between,u=a.swatch.right,x=a.swatch.width,b=a.swatch.height,y=a.swatch.belowBetween,w=a.swatch.below,v=t.select(e).append("svg"),B=t.select("body").append("div").attr("class","tooltip"),C=v.append("g").attr("class","sota-stackedColumnChart-mainChart"),k=document.querySelector(e).offsetWidth,A=k-h.left-h.right;t.csv(l+".csv").then(a=>{const l=a.columns.slice(1),$=t.map(a,t=>t.group).keys();var M=[];s?a.forEach(t=>{let a=0,e=[];for(let n of l){let l=+t[n];e.push([l,a]),a+=l}M.push(e)}):a.forEach(a=>{let e=0,n=t.sum(l,t=>+a[t]),s=[];for(let t of l){let l=+a[t]/n*100;s.push([l,e,+a[t]]),e+=l}M.push(s)});const j=r||s?M:a.map(t=>+t.value);if(null===i)i=s||r?0:t.min(j);else if(!0===i)i=t.min(j);else if(isNaN(i)||""===i)throw"invalid minVal for graph on "+e;if(null===o)o=s||r?100:t.max(j);else if(!0===o)o=t.max(j);else if(isNaN(o)||""===o)throw"invalid maxVal for graph on "+e;const G=t.scaleBand().domain($).range([0,A]).padding([.3]),S=t.scaleLinear().domain([i,o]).range([c,0]),L=t.scaleOrdinal().domain(l).range(t.map(l,(t,a)=>"module-fill-"+(l.length>3?a+1:2*a+1)).keys()),P=(C.append("g").attr("class","sota-gen-axis sota-gen-yAxis sota-num-axis").call(t.axisLeft(S).tickSize(-d)),C.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-text-axis").call(t.axisBottom(G).tickSize(0)).attr("transform",`translate(0 ${c})`));let N=!1;const W=P.selectAll("text"),I=W.nodes();for(let t in I){if(t==I.length-1)continue;let a=I[+t].getBBox(),e=I[+t+1].getBBox();if(a.x+a.width>e.x){N=!0;break}}N&&W.attr("text-anchor","end").style("transform",`translateY(4px) rotate(-${f}deg)`).node().classList.add("angled-label");let T=0,V=[];const z=v.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${h.top})`);if(z.selectAll("nothing").data(l).enter().append("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(function(){V.push(this.getBBox().width)})).remove(),t.sum(V,t=>t)+V.length*m+(V.length-1)*u>A){let a=A-t.max(V)-x-m;z.selectAll(".sota-gen-legend-swatch").data(l).join("rect").attr("class",t=>"sota-gen-legend-swatch "+L(t)).attr("x",a).attr("y",(t,a)=>(b+y)*a).attr("width",x).attr("height",b),z.selectAll(".sota-gen-legend-text").data(l).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",a+x+m).attr("y",(t,a)=>(b+y)*a+b/2).attr("alignment-baseline","central"),T=l.length*b+(l.length-1)*y+w}else{let a=A-(t.sum(V,t=>t)+l.length*(x+m)+(l.length-1)*u);z.selectAll(".sota-gen-legend-swatch").data(l).join("rect").attr("class",t=>"sota-gen-legend-swatch "+L(t)).attr("x",(e,n)=>a+n*(x+m+u)+t.sum(V.slice(0,n),t=>t)).attr("y",0).attr("width",x).attr("height",b),z.selectAll(".sota-gen-legend-text").data(l).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(e,n)=>a+n*(x+m+u)+x+m+t.sum(V.slice(0,n),t=>t)).attr("y",b/2).attr("alignment-baseline","central"),T=b+w}const O=C.selectAll(".sota-stackedColumnChart-group").data(M).join("g").attr("class","sota-stackedColumnChart-group").attr("transform",(t,a)=>"translate("+G($[a])+" 0)");if(O.selectAll(".sota-stackedColumnChart-bar").data(t=>t).join("rect").attr("class",(t,a)=>"sota-stackedColumnChart-bar "+L(a)).attr("x",0).attr("y",t=>S(t[0]+t[1])).attr("width",G.bandwidth()).attr("height",t=>c-S(t[0])).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),B.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"><span class="sota-heavy-label">${l[e]}</span><br/>Percentage: ${n(a[0])}`;return s||(t+="<br/>Number of responses: "+a[2]),t+="</span>",t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{B.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),B.style("opacity",0)})),O.selectAll(".sota-stackedColumnChart-separator").data(t=>t).join("rect").attr("class","sota-stackedColumnChart-separator").attr("fill","white").attr("x",0).attr("y",(t,a)=>S(t[0])+S(t[1])-c).attr("height",t=>t[0]>0?g:0).attr("width",G.bandwidth()),c+=T,N){let a=[];const e=P.select("text").node().getBBox(),n=e.y,l=e.height;P.selectAll("text").each((function(){a.push(this.getBBox().width)}));const s=t.max(a)*Math.sin(f*Math.PI/180),r=l*Math.cos(f*Math.PI/180);c+=n+s+r}else{let a=[];P.selectAll("text").each((function(){a.push(this.getBBox().y+this.getBBox().height)})),c+=+t.max(a)}let Y=c+h.top+h.bottom+T;v.style("width",k+2*p+"px").attr("height",Y).style("margin-left",-p),C.attr("transform",`translate(${h.left+p} ${h.top+T})`).attr("width",A)})},customColumnChart:function({selector:e,dataFile:n,shapeFile:r,shapeHeight:o=300,inputIsPercentage:i=!1,margin:c=a.margin}){const h=t.select(e).append("svg"),d=t.select("body").append("div").attr("class","tooltip"),g=h.append("g").attr("class","sota-mainChart"),p=document.querySelector(e).offsetWidth,f=a.separatorStrokeWidth;t.xml("shapes/"+r+".svg").then(a=>{let r=document.importNode(a.documentElement,!0),m=t.select(r).select("path").node(),u=0,x=0;h.append(()=>m).attr("class",(function(){return u=this.getBBox().width,x=this.getBBox().height,""})).remove();let b=o/x,y=u*b;h.append("defs").append("clipPath").attr("id","shapeDef"+e.substring(1)).append(()=>m).attr("transform",`scale(${b})`),t.csv(n+".csv").then(a=>{const[n,r,m]=s(a,i);let u=0,x=[];for(let t of a)x.push(u),u+=+t.value;const b=t.scaleLinear().domain([0,t.sum(a,t=>+t.value)]).range([0,o]),w=t.scaleOrdinal().domain(m).range(t.map(m,(t,a)=>"module-fill-"+(a+1)).keys());g.selectAll(".sota-customColumnChart-bar").data(a).join("rect").attr("class",t=>"sota-customColumnChart-bar "+w(t.label)).attr("x",0).attr("y",(t,a)=>b(x[a])).attr("width",y).attr("height",t=>b(t.value)).attr("clip-path","url(#shapeDef"+e.substring(1)+")").call(l,d,n,m,r),g.selectAll(".sota-customColumnChart-separator").data(a).join("rect").attr("class","sota-customColumnChart-separator").attr("x",0).attr("y",(t,a)=>0==a?-f:b(x[a])).attr("width",y).attr("height",f).attr("fill","white").attr("clip-path","url(#shapeDef"+e.substring(1)+")");const v=o+c.top+c.bottom;h.attr("height",v),g.attr("transform",`translate(${c.left} ${c.top})`).attr("width",p-c.left-c.right)})})},setColors:function(t){let a="";for(const e in t){a+=`#${e}{\n            background-color: ${t[e][0]};\n            color: ${t[e][0]};\n            }\n            #${e} .sota-gen-bar{\n                fill: ${t[e][3]};\n            }\n            `;for(const n in t[e])a+=`\n            #${e} .module-fill-${+n+1}{\n                fill: ${t[e][n]};\n            }\n            `}document.head.appendChild(document.createElement("style")).textContent=a},setStyles:function(t,e=a){const n=e.separatorStrokeWidth,l=e.lineColor;let s=`\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 700;\n\tsrc: url("${t}/Gotham/GothamBold.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 700;\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamBoldItalic.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tsrc: url("${t}/Gotham/GothamBook.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamBookItalic.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 300;\n\tsrc: url("${t}/Gotham/GothamLight.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 300;\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamLightItalic.ttf")\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Roman.otf");\n\tfont-weight: normal;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Italic.otf");\n\tfont-weight: normal;\n\tfont-style: italic\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Bold.otf");\n\tfont-weight: bold;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-BoldItalic.otf");\n\tfont-weight: bold;\n\tfont-style: italic\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Semibold.otf");\n\tfont-weight: 600;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-SemiboldItalic.otf");\n\tfont-weight: 600;\n\tfont-style: italic\n}\n\nbody{\n    margin: 0;\n}\n\nsection {\n\tpadding: 48px 0;\n\twidth: 100%\n}\n\nh1 {\n\tfont-size: 56px;\n\tfont-family: 'Gotham', sans-serif;\n\ttext-transform: uppercase;\n\tfont-weight: 700;\n\ttext-align: center;\n\tcolor: #fff\n}\n\n.container {\n    position: relative;\n\tmax-width: 1500px;\n\tbox-sizing: border-box;\n\tfont-family: "Gotham", Arial, sans-serif;\n\twidth: 100%;\n\tpadding: 48px 24px;\n\tmargin: 0 auto;\n\tdisplay: grid;\n\tcolumn-gap: 48px;\n\tbackground-color: #fff;\n\tgrid-template-columns: minmax(0, 1fr)\n}\n\n.container:before, .container:after{\n    pointer-events: none;\n    content: "";\n    position: absolute;\n    left: 0;\n    top: 32px;\n    height: calc(100% - 64px);\n    border-right: 1px solid rgba(0,0,0,0.1);\n    display: none;\n}\n\n.container .module-two-wide {\n\tgrid-column: 1/3\n}\n\n@media (min-width: 800px) {\n\t.container {\n\t\tgrid-template-columns: repeat(2, minmax(0, 1fr))\n\t}\n\n    .container:before{\n      width: 50%;\n      display: block;\n    }\n}\n\n@media (min-width: 1200px) {\n\t.container {\n\t\tgrid-template-columns: repeat(3, minmax(0, 1fr))\n\t}\n\n    .container:before{\n      width: 33.3%;\n    }\n    \n    .container:after{\n      width: 66.6%;\n      display: block;\n    }\n}\n\n.module {\n\tposition: relative;\n\twidth: 100%;\n\tborder-bottom: 1px solid rgba(0,0,0,0.2);\n\tmargin-bottom: 32px;\n}\n\n.module>svg {\n\twidth: 100%\n}\n\n.module h3 {\n\tfont-family: 'Gotham', sans-serif;\n\tfont-weight: 700;\n\ttext-transform: uppercase\n}\n\n.module .subtitle {\n\tfont-family: "Mercury Text G1", serif;\n\topacity: 0.4\n}\n\ntext{\n    fill: red;\n}\n\n.sota-heavy-label{\n    font-weight: 700;\n}\n\n.sota-num-label, .sota-num-axis .tick text{\n    font-family: "Gotham", sans-serif;\n    font-size: 14px;\n    fill: ${a.labelColor};\n}\n\n.sota-text-label, .sota-text-axis .tick text{\n    font-family: "Mercury Text G1", serif;\n    fill: black;\n}\n\n.sota-num-label.sota-stackedBarChart-label-onBar{\n    fill: rgba(255,255,255,0.6);\n}\n\n.tooltip {\n\tbackground-color: #222;\n\tcolor: #fff;\n\tpadding: 12px;\n\tposition: absolute;\n\tpointer-events: none;\n\topacity: 0;\n\ttransform: translate(-50%, -100%);\n\twhite-space: nowrap\n}\n\n.sota-gen-axis{\n    opacity: 0.4;\n}\n\n.sota-gen-axis.sota-gen-xAxis .tick text {\n\ttransform: translateY(4px);\n}\n\n.sota-gen-axis.sota-gen-yAxis .tick text {\n\ttransform: translateX(-8px);\n\ttext-anchor: end\n}\n\n.sota-gen-xAxis:not(.sota-text-axis) g.tick:first-of-type text:not(.angled-label){\n    text-anchor: start;\n}\n\n.sota-gen-xAxis:not(.sota-text-axis) g.tick:last-of-type text:not(.angled-label){\n    text-anchor: end;\n}\n\n.sota-gen-axis .tick line,\n.sota-gen-axis path.domain {\n\tstroke-width: ${n}px;\n\tstroke: ${l};\n}\n\n.sota-groupedBarChart-xAxis .tick line {\n\topacity: 0.2\n}\n\n.sota-big {\n\tfont-weight: 700;\n\tfont-size: 96px;\n\tline-height: 1.0;\n\tmargin-top: -8px;\n\tfont-family: "Mercury Text G1", serif\n}\n    `;document.head.appendChild(document.createElement("style")).textContent=s}};return r.sotaConfig=a,r.setParam=function(t,a){this.sotaConfig[t]=a},r.getParam=function(t){return this.sotaConfig[t]},r}));
