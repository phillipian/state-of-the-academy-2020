!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):(t=t||self).sota=e(t.d3)}(this,(function(t){"use strict";var e={separatorStrokeWidth:2,barHeight:32,barMargin:16,labelLeft:6,labelBelow:8,groupLabelMargin:32,xAxisTop:24,overflowOffset:24,lineColor:"#999999",mainHeight:300,tickSize:8,labelAngle:30,groupedBarChart:{barHeight:24,barMargin:8},margin:{top:20,bottom:20,left:0,right:0},swatch:{between:12,belowBetween:8,right:24,width:32,height:24,below:16}};function a(e){const a=e.node().offsetWidth/2,n=t.event.pageX;return n-a<0?a:n+a>window.innerWidth?window.innerWidth-a:n}function n(e){return t.format(".1f")(e)+"%"}function l(l,r,s,o,i){l.on("mouseover",(function(l,c){t.select(this).attr("opacity",e.hoverOpacity),r.style("opacity",1).html(()=>{let t=`<span class="sota-tooltip-label">${o[c]}</span><br/>Percentage: ${n(s[c])}`;return i&&(t+="<br/>Number of responses: "+i[c]),t}).style("left",a(r)+"px").style("top",t.event.pageY+"px")})).on("mousemove",e=>{r.style("left",a(r)+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(e){t.select(this).attr("opacity",1),r.style("opacity",0)}))}function r(e,a,n=null){return n=null==n?t.sum(e,t=>+t.value):n,[a?e.map(t=>+t.value).keys:e.map(t=>+t.value/n*100),!a&&e.map(t=>+t.value),e.map(t=>t.label)]}function s(t,e){for(let a of t._groups)if(Array.isArray(a))for(let t of a)o(t,e);else o(a,e)}function o(t,e){t.getBBox().x<e&&(t.style.display="none")}let i={barChart:function({selector:a,dataFile:s,inputIsPercentage:o=!1,showXAxis:i=!0,showSeparators:c=!0,displayPercentage:h=!0,totalResp:g=null,maxVal:p=null,minVal:d=null,margin:f=e.margin}){const m=e.tickSize,u=e.separatorStrokeWidth,x=e.labelLeft,y=e.barHeight,b=e.barMargin,w=e.overflowOffset,v=e.xAxisTop,B=t.select(a).append("svg"),C=t.select("body").append("div").attr("class","tooltip"),k=document.querySelector(a).offsetWidth,A=k-f.left-f.right,$=B.append("g").attr("class","sota-barChart-mainChart").attr("transform",`translate(${f.left+w} ${f.right})`).attr("width",A);t.csv(s+".csv").then(e=>{const s=y+b;let j=e.length*s;const[G,M,S]=r(e,o,g),L=h||o?G:M;if(null==d)d=o||h?0:t.min(L);else if(!0===d)d=t.min(L);else if(isNaN(d)||""===d)throw"invalid minVal for graph on "+a;if(null==p)p=o||h?100:t.max(L);else if(!0===p)p=t.max(L);else if(isNaN(p)||""===p)throw"invalid maxVal for graph on "+a;const P=t.scaleLinear().domain([d,p]).range([0,A]);let N;function T(t){return t*s}if(i&&(N=$.append("g").attr("class","sota-gen-axis sota-gen-xAxis").call(t.axisBottom(P).ticks(e.length).tickSize(-m)).attr("transform","translate(0 "+(j+v)+")")),$.selectAll(".sota-barChart-bar").data(L).join("rect").attr("class","sota-barChart-bar sota-gen-bar").attr("width",t=>P(t)).attr("height",y).attr("x",0).attr("y",(t,e)=>T(e)).call(l,C,G,S,M),$.selectAll(".sota-barChart-label").data(e).join("text").attr("class","sota-barChart-label").html(t=>t.label).attr("alignment-baseline","central").attr("x",x).attr("y",(t,e)=>T(e)+y/2),c&&$.selectAll(".sota-barChart-separator").data(L).join("line").attr("class","sota-barChart-separator").attr("x1",0).attr("x2",A).attr("y1",(t,e)=>T(e)+y+6).attr("y2",(t,e)=>T(e)+y+6).attr("stroke-width",u).attr("stroke","#dddddd"),$.selectAll(".sota-barChart-value").data(L).join("text").attr("class","sota-barChart-value").html((t,e)=>o||h?n(t):t).attr("alignment-baseline","central").attr("text-anchor","end").attr("x",A).attr("y",(t,e)=>T(e)+y/2),i){let e=[];N.selectAll("text").each((function(){e.push(this.getBBox().y+this.getBBox().height)})),j+=+t.max(e)}const V=j+f.top+f.bottom;B.style("width",k+2*w+"px").attr("height",V).style("margin-left",-w)})},pieChart:function({selector:a,dataFile:s,inputIsPercentage:o=!1,pieRad:i=150,pieThick:c=80,margin:h=e.margin}){const g=e.separatorStrokeWidth,p=e.swatch.between,d=e.swatch.right,f=e.swatch.width,m=e.swatch.height,u=e.swatch.belowBetween,x=e.swatch.below;var y=t.select(a).append("svg").attr("class","sota-pieChart"),b=t.select("body").append("div").attr("class","tooltip"),w=document.querySelector(a).offsetWidth,v=w-h.left-h.right,B=w-h.left-h.right;B<2*i&&(i=B/2),c>i&&(c=50);var C=2*i+h.top+h.bottom;t.csv(s+".csv").then(e=>{const[a,s,w]=r(e,o),k=t.pie()(a);let A=0,$=[];const j=t.scaleOrdinal().domain(w).range(t.map(w,(t,e)=>"module-fill-"+(e+1)).keys()),G=y.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${h.top})`);if(G.selectAll("nothing").data(e).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t.label).attr("x",(function(){$.push(this.getBBox().width)})).remove(),t.sum($,t=>t)+3*p+2*d>v){let e=v-t.max($)-f-p;G.selectAll(".sota-gen-legend-swatch").data(w).join("rect").attr("class",t=>"sota-gen-legend-swatch "+j(t)).attr("x",e).attr("y",(t,e)=>(m+u)*e).attr("width",f).attr("height",m),G.selectAll(".sota-gen-legend-text").data(w).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",e+f+p).attr("y",(t,e)=>(m+u)*e+m/2).attr("alignment-baseline","central"),A=w.length*m+(w.length-1)*u+x}else{let e=v-(t.sum($,t=>t)+w.length*(f+p)+(w.length-1)*d);G.selectAll(".sota-gen-legend-swatch").data(w).join("rect").attr("class",t=>"sota-gen-legend-swatch "+j(t)).attr("x",(a,n)=>e+n*(f+p+d)+t.sum($.slice(0,n),t=>t)).attr("y",0).attr("width",f).attr("height",m),G.selectAll(".sota-gen-legend-text").data(w).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(a,n)=>e+n*(f+p+d)+f+p+t.sum($.slice(0,n),t=>t)).attr("y",m/2).attr("alignment-baseline","central"),A=m+x}const M=y.append("g").attr("transform","translate("+B/2+","+(i+h.top+A)+")"),S=t.arc().innerRadius(.8*i-.8*c).outerRadius(.8*i),L=t.arc().innerRadius(.9*i).outerRadius(.9*i);M.selectAll(".sota-pieChart-slice").data(k).join("path").attr("class",(t,e)=>"sota-pieChart-slice module-fill-"+(e+1)).attr("d",S).attr("stroke","#fff").style("stroke-width",g).call(l,b,a,w,s),M.selectAll(".sota-pieChart-polyline").data(k).join("polyline").attr("class","sota-pieChart-polyline").attr("stroke","#999").style("fill","none").attr("stroke-width",2).attr("points",t=>{let e=S.centroid(t),a=L.centroid(t),n=L.centroid(t),l=t.startAngle+(t.endAngle-t.startAngle)/2;return n[0]=.95*i*(l<Math.PI?1:-1),[e,a,n]}),M.selectAll(".sota-pieChart-label").data(k).join("text").attr("class","sota-pieChart-label sota-floatingLabel").text((t,e)=>n(a[e])).attr("alignment-baseline","central").attr("transform",t=>{let e=L.centroid(t),a=t.startAngle+(t.endAngle-t.startAngle)/2;return e[0]=.99*i*(a<Math.PI?1:-1),"translate("+e+")"}).style("text-anchor",t=>t.startAngle+(t.endAngle-t.startAngle)/2<Math.PI?"start":"end"),y.attr("height",C+A)})},lineGraph:function({selector:a,dataFile:l,inputIsPercentage:r=!1,minVal:s=null,maxVal:o=null,height:i=300,customTooltipAppend:c="",prop5:h="value5",prop6:g="value6",margin:p={top:20,bottom:20,left:24,right:0}}){const d=t.select(a).append("svg").attr("class","sota-lineGraph"),f=t.select("body").append("div").attr("class","tooltip"),m=document.querySelector(a).offsetWidth;d.attr("height",i),t.csv(l+".csv").then(l=>{const c=e.separatorStrokeWidth,h=l.map(t=>t.label),g=l.map(t=>+t.value);if(null==s)s=r?0:t.min(l,t=>t.value);else if(1==s)s=t.min(l,t=>t.value);else if(isNaN(s)||""==s)throw"invalid minVal for graph on "+a;if(null==o)o=r?100:t.max(l,t=>t.value);else if(1==o)o=t.max(l,t=>t.value);else if(isNaN(o)||""==o)throw"invalid maxVal for graph on "+a;const u=t.scaleBand().domain(h.map(t=>t)).range([p.left,m-p.right]),x=t.scaleLinear().domain([s,o]).range([i-p.bottom,p.top]);d.append("g").attr("class","sota-gen-axis sota-gen-xAxis").call(t.axisBottom(u).ticks(l.length).tickSize(-8)).style("transform","translateY("+(i-p.bottom)+"px)"),d.append("g").attr("class","sota-gen-axis sota-gen-YAxis").call(t.axisLeft(x).tickSize(-8)).style("transform","translateX("+p.left+"px)"),d.selectAll(".sota-lineGraph-path").data([g]).join("path").attr("class","sota-lineGraph-path").attr("d",t.line().x((t,e)=>u(h[e])+u.bandwidth()/2).y(t=>x(t))).attr("fill","none").attr("stroke","#bbb").style("stroke-width",3),d.selectAll(".sota-lineGraph-circle").data(g).join("circle").attr("class","sota-lineGraph-circle").attr("cx",(t,e)=>u(h[e])+u.bandwidth()/2).attr("cy",t=>x(t)).attr("r",9).attr("stroke","white").style("stroke-width",c).on("mouseover",(function(e,a){t.select(this).attr("opacity",.8),f.style("opacity",1).html(`<span class="sota-tooltip-label">${h[a]}</span><br/>Value: `+(r?n(e):e)+"</span>").style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",e=>{f.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(e){t.select(this).attr("opacity",1),f.style("opacity",0)})),d.selectAll(".sota-lineGraph-label").data(g).join("text").attr("class","sota-lineGraph-label sota-floatingLabel").text((t,e)=>{if(r)return t+"%"}).attr("x",(t,e)=>u(h[e])+u.bandwidth()/2).attr("y",t=>x(t)-16).style("text-anchor","middle")})},stackedBarChart:function({selector:a,dataFile:l,inputIsPercentage:r=!1,showXAxis:o=!0,labelStyle:i="onBar",groupLabelStyle:c="none",showLegend:h=!0,prop5:g="value5",prop6:p="value6",margin:d=e.margin}){const f=e.separatorStrokeWidth,m=e.barHeight,u=e.barMargin,x=e.overflowOffset,y=e.groupLabelMargin,b=e.labelLeft,w=e.labelBelow,v=e.lineColor,B=e.swatch.between,C=e.swatch.right,k=e.swatch.width,A=e.swatch.height,$=e.swatch.belowBetween,j=e.swatch.below,G=e.xAxisTop;var M=t.select(a).append("svg"),S=t.select("body").append("div").attr("class","tooltip"),L=document.querySelector(a).offsetWidth,P=L-d.left-d.right;const N=M.append("g").attr("class","sota-stackedBarChart-mainChart").attr("transform",`translate(${d.left+x} ${d.right})`).attr("width",P);t.csv(l+".csv").then(e=>{var a=m+u,l=e.length*a,g=0;"onBar"==c&&(a+=e.length*y,l+=e.length*y,g=y);const p=e.columns.slice(1),T=t.map(e,t=>t.group).keys();var V=[];r?e.forEach(t=>{let e=0,a=[];for(let n of p){let l=+t[n];a.push([l,e]),e+=l}V.push(a)}):e.forEach(e=>{let a=0,n=t.sum(p,t=>+e[t]),l=[];for(let t of p){let r=+e[t]/n*100;l.push([r,a,+e[t]]),a+=r}V.push(l)});const W=t.scaleBand().domain(T).range([0,l]).padding([.2]),I=t.scaleLinear().domain([0,100]).range([0,P]),z=t.scaleOrdinal().domain(p).range(t.map(p,(t,e)=>"module-fill-"+(e+1)).keys());o&&(N.append("g").attr("class","sota-gen-axis sota-gen-xAxis").call(t.axisBottom(I).ticks(e.length).tickSize(-8)).attr("transform","translate(0 "+(l+G)+")"),l+=20+G);var O=0;if(h){let e=[];const a=M.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${d.top})`);if(a.selectAll("nothing").data(p).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(function(){e.push(this.getBBox().width)})).remove(),t.sum(e,t=>t)+3*B+2*C>P){let n=P-t.max(e)-k-B;a.selectAll(".sota-gen-legend-swatch").data(p).join("rect").attr("class",t=>"sota-gen-legend-swatch "+z(t)).attr("x",n).attr("y",(t,e)=>(A+$)*e).attr("width",k).attr("height",A),a.selectAll(".sota-gen-legend-text").data(p).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",n+k+B).attr("y",(t,e)=>(A+$)*e+A/2).attr("alignment-baseline","central"),O=p.length*A+(p.length-1)*$+j}else{let n=P-(t.sum(e,t=>t)+p.length*(k+B)+(p.length-1)*C);a.selectAll(".sota-gen-legend-swatch").data(p).join("rect").attr("class",t=>"sota-gen-legend-swatch "+z(t)).attr("x",(a,l)=>n+l*(k+B+C)+t.sum(e.slice(0,l),t=>t)).attr("y",0).attr("width",k).attr("height",A),a.selectAll(".sota-gen-legend-text").data(p).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(a,l)=>n+l*(k+B+C)+k+B+t.sum(e.slice(0,l),t=>t)).attr("y",A/2).attr("alignment-baseline","central"),O=A+j}}const Y=N.selectAll(".sota-stackedBarChart-group").data(V).join("g").attr("class","sota-stackedBarChart-group").attr("transform",(t,e)=>"translate(0 "+(W(T[e])+g-u)+")");Y.selectAll(".sota-stackedBarChart-bar").data(t=>t).join("rect").attr("class",(t,e)=>"sota-stackedBarChart-bar "+z(e)).attr("x",t=>I(t[1])).attr("y",0).attr("width",t=>I(t[0])).attr("height",m).on("mouseover",(function(e,a){t.select(this).attr("opacity",.8),S.style("opacity",1).html(()=>{let t=`<span class="sota-tooltip-label">${p[a]}</span><br/>Percentage: ${n(e[0])}`;return r||(t+="<br/>Number of responses: "+e[2]),t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{S.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(e){t.select(this).attr("opacity",1),S.style("opacity",0)})),Y.selectAll(".sota-stackedBarChart-separator").data(t=>t).join("rect").attr("class","sota-stackedBarChart-separator").attr("fill","white").attr("x",t=>I(t[1])+I(t[0])).attr("y",0).attr("width",t=>t[0]>0?f:0).attr("height",m),"onBar"==c&&N.selectAll(".sota-stackedBarChart-groupLabel-onBar").data(T).join("text").attr("class","sota-stackedBarChart-groupLabel-onBar sota-gen-groupLabel").text(t=>t).attr("alignment-baseline","bottom").attr("x",0).attr("y",t=>W(t));var X=0;if("onBar"==i)Y.selectAll(".sota-stackedBarChart-label-onBar").data(t=>t).join("text").attr("class","sota-stackedBarChart-label-onBar").text(e=>t.format(".1f")(e[0])+"%").attr("alignment-baseline","central").attr("text-anchor","end").attr("x",t=>I(t[1])+I(t[0])-b).attr("y",m/2).call(s,d.left);else if("aboveBar"==i){var H=[];Y.selectAll(".sota-stackedBarChart-label-aboveBar-text").data(t=>t).join("text").attr("class","sota-stackedBarChart-label-aboveBar-text").text((e,a)=>`${p[a]}: ${t.format(".1f")(e[0])}%`).attr("x",t=>I(t[1])+I(t[0])/2).attr("y",(function(t){return H.push([this.getBBox().x,this.getBBox().width]),-2*w})).attr("alignment-baseline","bottom");let e=[];!function t(a){if(a==H.length-1)return e[a]=-2,-2;if(H[a][0]+H[a][1]+b>H[a+1][0]){H[a+1][0]=H[a][0]+H[a][1]+b;let n=t(a+1)-1;return e[a]=n,n}return t(a+1),e[a]=-2,-2}(0),Y.selectAll(".sota-stackedBarChart-label-aboveBar-line").data(t=>t).join("polyline").attr("class","sota-stackedBarChart-label-aboveBar-line").attr("points",(t,a)=>{let n=I(t[1])+I(t[0])/2,l=m/2,r=n,s=(e[a]+1)*w;return`${n},${l} ${r},${s} ${H[a][0]+H[a][1]},${s}`}).attr("stroke-width",f).attr("stroke",v).attr("fill","none"),Y.selectAll(".sota-stackedBarChart-label-aboveBar-text").data(t=>t).join("text").attr("x",(t,e)=>H[e][0]).attr("y",(t,a)=>e[a]*w),X=-1*t.min(e)*w+20}const R=l+d.top+d.bottom+O+X;M.style("width",L+2*x+"px").attr("height",R).style("margin-left",-x),N.attr("transform",`translate(${x} ${d.top+O+X})`).attr("width",P)})},customBarChart:function({selector:a,dataFile:s,shapeFile:o,shapeWidth:i=300,inputIsPercentage:c=!1,margin:h=e.margin}){var g=t.select(a).append("svg"),p=t.select("body").append("div").attr("class","tooltip");const d=g.append("g").attr("class","sota-mainChart");var f=document.querySelector(a).offsetWidth;const m=e.separatorStrokeWidth,u=e.labelLeft,x=e.labelBelow,y=e.lineColor;t.xml("shapes/"+o+".svg").then(e=>{let a=document.importNode(e.documentElement,!0),o=t.select(a).select("path").node(),b=0,w=0;g.append(()=>o).attr("class",(function(){return b=this.getBBox().width,w=this.getBBox().height,""})).remove();let v=i/b,B=w*v;g.append("defs").append("clipPath").attr("id","shapeDef").append(()=>o).attr("transform",`scale(${v})`),t.csv(s+".csv").then(e=>{const[a,s,o]=r(e,c);let b=0,w=[];for(let t of e)w.push(b),b+=+t.value;const v=t.scaleLinear().domain([0,t.sum(e,t=>+t.value)]).range([0,i]),C=t.scaleOrdinal().domain(t.map(e,t=>t.label)).range(t.map(e,(t,e)=>"module-fill-"+(e+1)).keys());d.selectAll(".sota-customBarChart-bar").data(e).join("rect").attr("class",t=>"sota-customBarChart-bar "+C(t.label)).attr("x",(t,e)=>v(w[e])).attr("y",0).attr("width",t=>v(t.value)).attr("height",B).attr("clip-path","url(#shapeDef)").call(l,p,a,o,s),d.selectAll(".sota-customBarChart-separator").data(e).join("rect").attr("class","sota-customBarChart-separator").attr("x",(t,e)=>0==e?-m:v(w[e])).attr("y",0).attr("width",m).attr("height",B).attr("fill","white").attr("clip-path","url(#shapeDef)");var k=[];d.selectAll(".sota-customBarChart-label-aboveBar-text").data(e).join("text").attr("class","sota-customBarChart-label-aboveBar-text").text((t,e)=>`${t.label}: ${n(a[e])}`).attr("x",(t,e)=>v(w[e])+v(t.value)/2+u).attr("y",(function(t){return k.push([this.getBBox().x,this.getBBox().width]),B+3*x})).attr("alignment-baseline","top");let A=[];!function t(e){if(e==k.length-1)return A[e]=3,3;if(k[e][0]+k[e][1]+2*u>k[e+1][0]){k[e+1][0]=k[e][0]+k[e][1]+2*u;let a=t(e+1)+1;return A[e]=a,a}return t(e+1),A[e]=3,3}(0),d.selectAll(".sota-customBarChart-label-aboveBar-line").data(e).join("polyline").attr("class","sota-customBarChart-label-aboveBar-line").attr("points",(t,e)=>{let a=v(w[e])+v(t.value)/2,n=B-x,l=a,r=B+(A[e]+1)*x;return`${a},${n} ${l},${r} ${k[e][0]+k[e][1]},${r}`}).attr("stroke-width",m).attr("stroke",y).attr("fill","none"),d.selectAll(".sota-customBarChart-label-aboveBar-text").data(e).join("text").attr("x",(t,e)=>k[e][0]).attr("y",(t,e)=>B+A[e]*x);let $=t.max(A)*x+20,j=B+h.top+h.bottom+$;g.attr("height",j),d.attr("transform",`translate(${h.left} ${h.top})`).attr("width",f-h.left-h.right)})})},columnChart:function({selector:a,dataFile:n,inputIsPercentage:s=!1,displayPercentage:o=!0,totalResp:i=null,maxVal:c=null,minVal:h=null,mainHeight:g=e.mainHeight,showLegend:p=!1,margin:d={top:20,bottom:20,left:24,right:0}}){const f=e.overflowOffset,m=e.tickSize,u=e.labelAngle,x=e.swatch.between,y=e.swatch.right,b=e.swatch.width,w=e.swatch.height,v=e.swatch.belowBetween,B=e.swatch.below,C=t.select(a).append("svg"),k=t.select("body").append("div").attr("class","tooltip"),A=C.append("g").attr("class","sota-mainChart"),$=document.querySelector(a).offsetWidth,j=$-d.left-d.right;t.csv(n+".csv").then(e=>{const[n,G,M]=r(e,s,i),S=o||s?n:G;if(null===h)h=s||o?0:t.min(S);else if(!0===h)h=t.min(S);else if(isNaN(h)||""===h)throw"invalid minVal for graph on "+a;if(null===c)c=s||o?100:t.max(S);else if(!0===c)c=t.max(S);else if(isNaN(c)||""===c)throw"invalid maxVal for graph on "+a;const L=t.scaleBand().domain(M).range([0,j]).padding([.3]),P=t.scaleLinear().domain([h,c]).range([g,0]),N=t.scaleOrdinal().domain(M).range(t.map(M,(t,e)=>"module-fill-"+(e+1)).keys());let T,V=0,W=!1;if(p){let a=[];const n=C.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${d.top})`);if(n.selectAll("nothing").data(e).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t.label).attr("x",(function(){a.push(this.getBBox().width)})).remove(),t.sum(a,t=>t)+a.length*x+(a.length-1)*y>j){let e=j-t.max(a)-b-x;n.selectAll(".sota-gen-legend-swatch").data(M).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",e).attr("y",(t,e)=>(w+v)*e).attr("width",b).attr("height",w),n.selectAll(".sota-gen-legend-text").data(M).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",e+b+x).attr("y",(t,e)=>(w+v)*e+w/2).attr("alignment-baseline","central"),V=M.length*w+(M.length-1)*v+B}else{let e=j-(t.sum(a,t=>t)+M.length*(b+x)+(M.length-1)*y);n.selectAll(".sota-gen-legend-swatch").data(M).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",(n,l)=>e+l*(b+x+y)+t.sum(a.slice(0,l),t=>t)).attr("y",0).attr("width",b).attr("height",w),n.selectAll(".sota-gen-legend-text").data(M).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(n,l)=>e+l*(b+x+y)+b+x+t.sum(a.slice(0,l),t=>t)).attr("y",w/2).attr("alignment-baseline","central"),V=w+B}}else{T=A.append("g").attr("class","sota-gen-axis sota-gen-xAxis").call(t.axisBottom(L).tickSize(0)).attr("transform",`translate(0 ${g})`);const e=T.selectAll("text"),a=e.nodes();for(let t in a){if(t==a.length-1)continue;let e=a[+t].getBBox(),n=a[+t+1].getBBox();if(e.x+e.width>n.x){W=!0;break}}W&&e.attr("text-anchor","end").style("transform",`translateY(4px) rotate(-${u}deg)`)}A.append("g").attr("class","sota-gen-axis sota-gen-yAxis").call(t.axisLeft(P).tickSize(-m));if(A.selectAll(".sota-columnChart-bar").data(S).join("rect").attr("class",(t,e)=>{let a="sota-columnChart-bar sota-gen-bar";return a+=p?" "+N(M[e]):"",a}).attr("x",(t,e)=>L(M[e])).attr("y",t=>P(t)).attr("width",L.bandwidth()).attr("height",t=>g-P(t)).call(l,k,n,M,G),p)g+=V;else if(W){let e=[];const a=T.select("text").node().getBBox(),n=a.y,l=a.height;T.selectAll("text").each((function(){e.push(this.getBBox().width)}));const r=t.max(e)*Math.sin(u*Math.PI/180),s=l*Math.cos(u*Math.PI/180);g+=n+r+s}else{let e=[];T.selectAll("text").each((function(){e.push(this.getBBox().y+this.getBBox().height)})),g+=+t.max(e)}let I=g+d.top+d.bottom;C.style("width",$+2*f+"px").attr("height",I).style("margin-left",-f),A.attr("transform",`translate(${d.left+f} ${d.top+V})`).attr("width",j)})},groupedBarChart:function({selector:a,dataFile:l,totalResp:r=null,inputIsPercentage:s=!1,displayPercentage:o=!0,minVal:i=0,maxVal:c=null,margin:h=e.margin}){const g=e.groupedBarChart.barHeight,p=e.groupedBarChart.barMargin,d=e.overflowOffset,f=e.groupLabelMargin,m=(e.swatch.between,e.swatch.right,e.swatch.width,e.swatch.height,e.swatch.belowBetween,e.swatch.below,e.xAxisTop),u=t.select(a).append("svg"),x=t.select("body").append("div").attr("class","tooltip"),y=u.append("g").attr("class","sota-mainChart"),b=document.querySelector(a).offsetWidth,w=b-h.left-h.right;t.csv(l+".csv").then(e=>{window.wow=e;const l=e.columns.splice(1),v=t.map(e,t=>t.group).keys(),B=t.map(e,e=>{let a=[];for(let t of l)a.push(+e[t]);return t.max(a)}).keys(),C=t.max(B,t=>+t);if(null==c)c=s||o?100:C;else if(isNaN(c)||""===c)throw"invalid maxVal for graph on "+a;const k=g+p,A=k*l.length;let $=(A+f)*e.length;const j=t.scaleLinear().domain([i,c]).range([0,w]),G=t.scaleOrdinal().domain(t.map(e,t=>t.group)).range(t.map(e,(t,e)=>(A+f)*e).keys()),M=t.scaleOrdinal().domain(l).range(t.map(l,(t,e)=>k*e).keys());y.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-groupedBarChart-xAxis").call(t.axisBottom(j).tickSize(-($+m))).attr("transform","translate(0 "+($+m)+")");$+=20+m;const S=y.selectAll(".sota-groupedBarChart-group").data(e).join("g").attr("class","sota-groupedBarChart-group").attr("transform",(t,e)=>`translate(0 ${G(t.group)})`),L=t.scaleOrdinal().domain(l).range(t.map(l,(t,e)=>"module-fill-"+(e+1)).keys());S.selectAll(".sota-gen-bar").data(t=>{let e=[];for(let a of l)e.push(+t[a]);return e}).join("rect").attr("class",(t,e)=>"sota-gen-bar "+L(l[e])).attr("y",(t,e)=>+M(l[e])+ +f).attr("x",0).attr("width",(t,e)=>j(s?t:t/r[l[e]]*100)).attr("height",g).on("mouseover",(function(e,a){t.select(this).attr("opacity",.8),x.style("opacity",1).html(()=>{let t=`<span class="sota-tooltip-label">${l[a]}</span><br/>Percentage: ${n(s?e:e/r[l[a]]*100)}`;return s||(t+="<br/>Number of responses: "+e),t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{x.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(e){t.select(this).attr("opacity",1),x.style("opacity",0)})),y.selectAll(".sota-gen-groupLabel").data(v).join("text").attr("class","sota-gen-groupLabel").text(t=>t).attr("alignment-baseline","bottom").attr("x",0).attr("y",t=>+G(t)+ +f).attr("transform","translate(0 -8)");let P=$+h.top+h.bottom;u.style("width",b+2*d+"px").attr("height",P).style("margin-left",-d),y.attr("transform",`translate(${h.left+d} ${h.top})`).attr("width",w)})},stackedColumnChart:function({selector:a,dataFile:l,inputIsPercentage:r=!1,displayPercentage:s=!0,totalResp:o=null,maxVal:i=null,minVal:c=null,mainHeight:h=e.mainHeight,margin:g={top:20,bottom:20,left:24,right:0}}){const p=e.tickSize,d=e.separatorStrokeWidth,f=e.overflowOffset,m=e.swatch.between,u=e.swatch.right,x=e.swatch.width,y=e.swatch.height,b=e.swatch.belowBetween,w=e.swatch.below,v=t.select(a).append("svg"),B=t.select("body").append("div").attr("class","tooltip"),C=v.append("g").attr("class","sota-stackedColumnChart-mainChart"),k=document.querySelector(a).offsetWidth,A=k-g.left-g.right;t.csv(l+".csv").then(e=>{const l=e.columns.slice(1),o=t.map(e,t=>t.group).keys();var $=[];r?e.forEach(t=>{let e=0,a=[];for(let n of l){let l=+t[n];a.push([l,e]),e+=l}$.push(a)}):e.forEach(e=>{let a=0,n=t.sum(l,t=>+e[t]),r=[];for(let t of l){let l=+e[t]/n*100;r.push([l,a,+e[t]]),a+=l}$.push(r)});const j=s||r?$:e.map(t=>+t.value);if(null===c)c=r||s?0:t.min(j);else if(!0===c)c=t.min(j);else if(isNaN(c)||""===c)throw"invalid minVal for graph on "+a;if(null===i)i=r||s?100:t.max(j);else if(!0===i)i=t.max(j);else if(isNaN(i)||""===i)throw"invalid maxVal for graph on "+a;const G=t.scaleBand().domain(o).range([0,A]).padding([.3]),M=t.scaleLinear().domain([c,i]).range([h,0]),S=t.scaleOrdinal().domain(l).range(t.map(l,(t,e)=>"module-fill-"+(e+1)).keys()),L=(C.append("g").attr("class","sota-gen-axis sota-gen-yAxis").call(t.axisLeft(M).tickSize(-p)),C.append("g").attr("class","sota-gen-axis sota-gen-xAxis").call(t.axisBottom(G).ticks(e.length).tickSize(-p)).attr("transform","translate(0 "+h+")"));let P=0,N=[];const T=v.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${g.top})`);if(T.selectAll("nothing").data(l).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(function(){N.push(this.getBBox().width)})).remove(),t.sum(N,t=>t)+N.length*m+(N.length-1)*u>A){let e=A-t.max(N)-x-m;T.selectAll(".sota-gen-legend-swatch").data(l).join("rect").attr("class",t=>"sota-gen-legend-swatch "+S(t)).attr("x",e).attr("y",(t,e)=>(y+b)*e).attr("width",x).attr("height",y),T.selectAll(".sota-gen-legend-text").data(l).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",e+x+m).attr("y",(t,e)=>(y+b)*e+y/2).attr("alignment-baseline","central"),P=l.length*y+(l.length-1)*b+w}else{let e=A-(t.sum(N,t=>t)+l.length*(x+m)+(l.length-1)*u);T.selectAll(".sota-gen-legend-swatch").data(l).join("rect").attr("class",t=>"sota-gen-legend-swatch "+S(t)).attr("x",(a,n)=>e+n*(x+m+u)+t.sum(N.slice(0,n),t=>t)).attr("y",0).attr("width",x).attr("height",y),T.selectAll(".sota-gen-legend-text").data(l).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(a,n)=>e+n*(x+m+u)+x+m+t.sum(N.slice(0,n),t=>t)).attr("y",y/2).attr("alignment-baseline","central"),P=y+w}const V=C.selectAll(".sota-stackedColumnChart-group").data($).join("g").attr("class","sota-stackedColumnChart-group").attr("transform",(t,e)=>"translate("+G(o[e])+" 0)");V.selectAll(".sota-stackedColumnChart-bar").data(t=>t).join("rect").attr("class",(t,e)=>"sota-stackedColumnChart-bar "+S(e)).attr("x",0).attr("y",t=>M(t[0]+t[1])).attr("width",G.bandwidth()).attr("height",t=>h-M(t[0])).on("mouseover",(function(e,a){t.select(this).attr("opacity",.8),B.style("opacity",1).html(()=>{let t=`<span class="sota-tooltip-label">${l[a]}</span><br/>Percentage: ${n(e[0])}`;return r||(t+="<br/>Number of responses: "+e[2]),t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{B.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(e){t.select(this).attr("opacity",1),B.style("opacity",0)})),V.selectAll(".sota-stackedColumnChart-separator").data(t=>t).join("rect").attr("class","sota-stackedColumnChart-separator").attr("fill","white").attr("x",0).attr("y",(t,e)=>M(t[0])+M(t[1])-h).attr("height",t=>t[0]>0?d:0).attr("width",G.bandwidth()),h+=P;{let e=[];L.selectAll("text").each((function(){e.push(this.getBBox().y+this.getBBox().height)})),h+=+t.max(e)}let W=h+g.top+g.bottom+P;v.style("width",k+2*f+"px").attr("height",W).style("margin-left",-f),C.attr("transform",`translate(${g.left+f} ${g.top+P})`).attr("width",A)})},setColors:function(t){let e="";for(const a in t){e+=`#${a}{\n            background-color: ${t[a][0]};\n            color: ${t[a][0]};\n            }\n            #${a} .sota-gen-bar{\n                fill: ${t[a][0]};\n            }\n            `;for(const n in t[a])e+=`\n            #${a} .module-fill-${+n+1}{\n                fill: ${t[a][n]};\n            }\n            `}document.head.appendChild(document.createElement("style")).textContent=e},setStyles:function(t,a=e){let n=`\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 700;\n\tsrc: url("${t}/Gotham/GothamBold.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 700;\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamBoldItalic.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tsrc: url("${t}/Gotham/GothamBook.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamBookItalic.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 300;\n\tsrc: url("${t}/Gotham/GothamLight.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 300;\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamLightItalic.ttf")\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Roman.otf");\n\tfont-weight: normal;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Italic.otf");\n\tfont-weight: normal;\n\tfont-style: italic\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Bold.otf");\n\tfont-weight: bold;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-BoldItalic.otf");\n\tfont-weight: bold;\n\tfont-style: italic\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Semibold.otf");\n\tfont-weight: 600;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-SemiboldItalic.otf");\n\tfont-weight: 600;\n\tfont-style: italic\n}\n\nbody {\n\tmargin: 0\n}\n\nsection {\n\tpadding: 48px 0;\n\twidth: 100%\n}\n\nh1 {\n\tfont-size: 56px;\n\tfont-family: 'Gotham', sans-serif;\n\ttext-transform: uppercase;\n\tfont-weight: 700;\n\ttext-align: center;\n\tcolor: #fff\n}\n\n.container {\n\tmax-width: 1500px;\n\tbox-sizing: border-box;\n\tfont-family: "Gotham", Arial, sans-serif;\n\twidth: 100%;\n\tpadding: 48px 24px;\n\tmargin: 0 auto;\n\tdisplay: grid;\n\tcolumn-gap: 24px;\n\tbackground-color: #fff;\n\tgrid-template-columns: minmax(0, 1fr)\n}\n\n.container .module-two-wide {\n\tgrid-column: 1/3\n}\n\n@media (min-width: 800px) {\n\t.container {\n\t\tgrid-template-columns: repeat(2, minmax(0, 1fr))\n\t}\n}\n\n@media (min-width: 1200px) {\n\t.container {\n\t\tgrid-template-columns: repeat(3, minmax(0, 1fr))\n\t}\n}\n\n.module {\n\tposition: relative;\n\twidth: 100%\n}\n\n.module>svg {\n\twidth: 100%\n}\n\n.module h3 {\n\tfont-family: 'Gotham', sans-serif;\n\tfont-weight: 700;\n\ttext-transform: uppercase\n}\n\n.module .subtitle {\n\tfont-family: "Mercury Text G1", serif;\n\topacity: 0.4\n}\n\n.module text {\n\tpointer-events: none\n}\n\n.tooltip {\n\tbackground-color: #222;\n\tcolor: #fff;\n\tpadding: 12px;\n\tposition: absolute;\n\tpointer-events: none;\n\topacity: 0;\n\ttransform: translate(-50%, -100%);\n\twhite-space: nowrap\n}\n\n.tooltip .sota-tooltip-label {\n\tfont-weight: 700\n}\n\n.sota-barChart-label,\n.sota-pieChart-label,\n.sota-gen-groupLabel {\n\tfont-family: 'Mercury Text G1', serif;\n\tfont-weight: 700\n}\n\n.sota-floatingLabel {\n\tfont-weight: 700\n}\n\n.sota-gen-axis.sota-gen-xAxis .tick text {\n\ttransform: translateY(4px);\n}\n\n.sota-gen-axis.sota-gen-yAxis .tick text {\n\ttransform: translateX(-8px);\n\ttext-anchor: end\n}\n\n.sota-gen-axis .tick text {\n\tcolor: #999;\n\tfont-size: 16px;\n\tfont-family: 'Gotham', sans-serif;\n\tfont-weight: 700\n}\n\n.sota-gen-axis .tick line,\n.sota-gen-axis path.domain {\n\tstroke-width: ${a.separatorStrokeWidth}px;\n\tstroke: ${a.lineColor};\n}\n\n.sota-groupedBarChart-xAxis .tick line {\n\topacity: 0.2\n}\n\n.sota-big {\n\tfont-weight: 700;\n\tfont-size: 96px;\n\tline-height: 1.0;\n\tmargin-top: -8px;\n\tfont-family: "Mercury Text G1", serif\n}\n    `;document.head.appendChild(document.createElement("style")).textContent=n}};return i.sotaConfig=e,i.setParam=function(t,e){this.sotaConfig[t]=e},i.getParam=function(t){return this.sotaConfig[t]},i}));
