!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):(t=t||self).sota=e(t.d3)}(this,(function(t){"use strict";var e={separatorStrokeWidth:2,barHeight:32,barMargin:16,labelLeft:6,labelBelow:8,groupLabelMargin:32,xAxisTop:24,overflowOffset:24,lineColor:"#999999",mainHeight:300,tickSize:8,labelAngle:30,groupedBarChart:{barHeight:24,barMargin:8},margin:{top:20,bottom:20,left:0,right:0},swatch:{between:12,belowBetween:8,right:24,width:32,height:24,below:16}};function a(e){const a=e.node().offsetWidth/2,l=t.event.pageX;return l-a<0?a:l+a>window.innerWidth?window.innerWidth-a:l}function l(e){return t.format(".1f")(e)+"%"}function s(s,r,n,o,i){s.on("mouseover",(function(s,c){t.select(this).attr("opacity",e.hoverOpacity),r.style("opacity",1).html(()=>{let t=`<span class="sota-tooltip-label">${o[c]}</span><br/>Percentage: ${l(n[c])}`;return i&&(t+="<br/>Number of responses: "+i[c]),t}).style("left",a(r)+"px").style("top",t.event.pageY+"px")})).on("mousemove",e=>{r.style("left",a(r)+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(e){t.select(this).attr("opacity",1),r.style("opacity",0)}))}function r(e,a,l=null){return l=null==l?t.sum(e,t=>+t.value):l,[a?e.map(t=>+t.value).keys:e.map(t=>+t.value/l*100),!a&&e.map(t=>+t.value),e.map(t=>t.label)]}function n(t,e){for(let a of t._groups)if(Array.isArray(a))for(let t of a)o(t,e);else o(a,e)}function o(t,e){t.getBBox().x<e&&(t.style.display="none")}let i={barChart:function({selector:a,dataFile:n,inputIsPercentage:o=!1,showXAxis:i=!0,showSeparators:c=!0,displayPercentage:h=!0,totalResp:g=null,maxVal:p=null,minVal:d=null,margin:m=e.margin}){const u=e.tickSize,f=e.separatorStrokeWidth,x=e.labelLeft,b=e.barHeight,y=e.barMargin,w=e.overflowOffset,v=e.xAxisTop,B=t.select(a).append("svg"),A=t.select("body").append("div").attr("class","tooltip"),C=document.querySelector(a).offsetWidth,k=C-m.left-m.right,j=B.append("g").attr("class","sota-barChart-mainChart").attr("transform",`translate(${m.left+w} ${m.right})`).attr("width",k);t.csv(n+".csv").then(e=>{const n=b+y;let $=e.length*n;const[S,L,N]=r(e,o,g),P=h||o?S:L;if(null==d)d=o||h?0:t.min(P);else if(!0===d)d=t.min(P);else if(isNaN(d)||""===d)throw"invalid minVal for graph on "+a;if(null==p)p=o||h?100:t.max(P);else if(!0===p)p=t.max(P);else if(isNaN(p)||""===p)throw"invalid maxVal for graph on "+a;const V=t.scaleLinear().domain([d,p]).range([0,k]);let W;function M(t){return t*n}if(i&&(W=j.append("g").attr("class","sota-gen-axis sota-gen-xAxis").call(t.axisBottom(V).ticks(e.length).tickSize(-u)).attr("transform","translate(0 "+($+v)+")")),j.selectAll(".sota-barChart-bar").data(P).join("rect").attr("class","sota-barChart-bar sota-gen-bar").attr("width",t=>V(t)).attr("height",b).attr("x",0).attr("y",(t,e)=>M(e)).call(s,A,S,N,L),j.selectAll(".sota-barChart-label").data(e).join("text").attr("class","sota-barChart-label").html(t=>t.label).attr("alignment-baseline","central").attr("x",x).attr("y",(t,e)=>M(e)+b/2),c&&j.selectAll(".sota-barChart-separator").data(P).join("line").attr("class","sota-barChart-separator").attr("x1",0).attr("x2",k).attr("y1",(t,e)=>M(e)+b+6).attr("y2",(t,e)=>M(e)+b+6).attr("stroke-width",f).attr("stroke","#dddddd"),j.selectAll(".sota-barChart-value").data(P).join("text").attr("class","sota-barChart-value").html((t,e)=>o||h?l(t):t).attr("alignment-baseline","central").attr("text-anchor","end").attr("x",k).attr("y",(t,e)=>M(e)+b/2),i){let e=[];W.selectAll("text").each((function(){e.push(this.getBBox().y+this.getBBox().height)})),$+=+t.max(e)}const O=$+m.top+m.bottom;B.style("width",C+2*w+"px").attr("height",O).style("margin-left",-w)})},pieChart:function({selector:a,dataFile:n,inputIsPercentage:o=!1,pieRad:i=150,pieThick:c=80,margin:h=e.margin}){const g=e.separatorStrokeWidth,p=e.swatch.between,d=e.swatch.right,m=e.swatch.width,u=e.swatch.height,f=e.swatch.belowBetween,x=e.swatch.below;var b=t.select(a).append("svg").attr("class","sota-pieChart"),y=t.select("body").append("div").attr("class","tooltip"),w=document.querySelector(a).offsetWidth,v=w-h.left-h.right,B=w-h.left-h.right;B<2*i&&(i=B/2),c>i&&(c=50);var A=2*i+h.top+h.bottom;t.csv(n+".csv").then(e=>{const[a,n,w]=r(e,o),C=t.pie()(a);let k=0,j=[];const $=t.scaleOrdinal().domain(w).range(t.map(w,(t,e)=>"module-fill-"+(e+1)).keys()),S=b.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${h.top})`);if(S.selectAll("nothing").data(e).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t.label).attr("x",(function(){j.push(this.getBBox().width)})).remove(),t.sum(j,t=>t)+3*p+2*d>v){let e=v-t.max(j)-m-p;S.selectAll(".sota-gen-legend-swatch").data(w).join("rect").attr("class",t=>"sota-gen-legend-swatch "+$(t)).attr("x",e).attr("y",(t,e)=>(u+f)*e).attr("width",m).attr("height",u),S.selectAll(".sota-gen-legend-text").data(w).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",e+m+p).attr("y",(t,e)=>(u+f)*e+u/2).attr("alignment-baseline","central"),k=w.length*u+(w.length-1)*f+x}else{let e=v-(t.sum(j,t=>t)+w.length*(m+p)+(w.length-1)*d);S.selectAll(".sota-gen-legend-swatch").data(w).join("rect").attr("class",t=>"sota-gen-legend-swatch "+$(t)).attr("x",(a,l)=>e+l*(m+p+d)+t.sum(j.slice(0,l),t=>t)).attr("y",0).attr("width",m).attr("height",u),S.selectAll(".sota-gen-legend-text").data(w).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(a,l)=>e+l*(m+p+d)+m+p+t.sum(j.slice(0,l),t=>t)).attr("y",u/2).attr("alignment-baseline","central"),k=u+x}const L=b.append("g").attr("transform","translate("+B/2+","+(i+h.top+k)+")"),N=t.arc().innerRadius(.8*i-.8*c).outerRadius(.8*i),P=t.arc().innerRadius(.9*i).outerRadius(.9*i);L.selectAll(".sota-pieChart-slice").data(C).join("path").attr("class",(t,e)=>"sota-pieChart-slice module-fill-"+(e+1)).attr("d",N).attr("stroke","#fff").style("stroke-width",g).call(s,y,a,w,n),L.selectAll(".sota-pieChart-polyline").data(C).join("polyline").attr("class","sota-pieChart-polyline").attr("stroke","#999").style("fill","none").attr("stroke-width",2).attr("points",t=>{let e=N.centroid(t),a=P.centroid(t),l=P.centroid(t),s=t.startAngle+(t.endAngle-t.startAngle)/2;return l[0]=.95*i*(s<Math.PI?1:-1),[e,a,l]}),L.selectAll(".sota-pieChart-label").data(C).join("text").attr("class","sota-pieChart-label sota-floatingLabel").text((t,e)=>l(a[e])).attr("alignment-baseline","central").attr("transform",t=>{let e=P.centroid(t),a=t.startAngle+(t.endAngle-t.startAngle)/2;return e[0]=.99*i*(a<Math.PI?1:-1),"translate("+e+")"}).style("text-anchor",t=>t.startAngle+(t.endAngle-t.startAngle)/2<Math.PI?"start":"end"),b.attr("height",A+k)})},lineGraph:function({selector:a,dataFile:s,inputIsPercentage:r=!1,minVal:n=null,maxVal:o=null,height:i=300,customTooltipAppend:c="",prop5:h="value5",prop6:g="value6",margin:p={top:20,bottom:20,left:24,right:0}}){const d=t.select(a).append("svg").attr("class","sota-lineGraph"),m=t.select("body").append("div").attr("class","tooltip"),u=document.querySelector(a).offsetWidth;d.attr("height",i),t.csv(s+".csv").then(s=>{const c=e.separatorStrokeWidth,h=s.map(t=>t.label),g=s.map(t=>+t.value);if(null==n)n=r?0:t.min(s,t=>t.value);else if(1==n)n=t.min(s,t=>t.value);else if(isNaN(n)||""==n)throw"invalid minVal for graph on "+a;if(null==o)o=r?100:t.max(s,t=>t.value);else if(1==o)o=t.max(s,t=>t.value);else if(isNaN(o)||""==o)throw"invalid maxVal for graph on "+a;const f=t.scaleBand().domain(h.map(t=>t)).range([p.left,u-p.right]),x=t.scaleLinear().domain([n,o]).range([i-p.bottom,p.top]);d.append("g").attr("class","sota-gen-axis sota-gen-xAxis").call(t.axisBottom(f).ticks(s.length).tickSize(-8)).style("transform","translateY("+(i-p.bottom)+"px)"),d.append("g").attr("class","sota-gen-axis sota-gen-YAxis").call(t.axisLeft(x).tickSize(-8)).style("transform","translateX("+p.left+"px)"),d.selectAll(".sota-lineGraph-path").data([g]).join("path").attr("class","sota-lineGraph-path").attr("d",t.line().x((t,e)=>f(h[e])+f.bandwidth()/2).y(t=>x(t))).attr("fill","none").attr("stroke","#bbb").style("stroke-width",3),d.selectAll(".sota-lineGraph-circle").data(g).join("circle").attr("class","sota-lineGraph-circle").attr("cx",(t,e)=>f(h[e])+f.bandwidth()/2).attr("cy",t=>x(t)).attr("r",9).attr("stroke","white").style("stroke-width",c).on("mouseover",(function(e,a){t.select(this).attr("opacity",.8),m.style("opacity",1).html(`<span class="sota-tooltip-label">${h[a]}</span><br/>Value: `+(r?l(e):e)+"</span>").style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",e=>{m.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(e){t.select(this).attr("opacity",1),m.style("opacity",0)})),d.selectAll(".sota-lineGraph-label").data(g).join("text").attr("class","sota-lineGraph-label sota-floatingLabel").text((t,e)=>{if(r)return t+"%"}).attr("x",(t,e)=>f(h[e])+f.bandwidth()/2).attr("y",t=>x(t)-16).style("text-anchor","middle")})},stackedBarChart:function({selector:a,dataFile:s,inputIsPercentage:r=!1,showXAxis:o=!0,labelStyle:i="onBar",groupLabelStyle:c="none",showLegend:h=!0,prop5:g="value5",prop6:p="value6",margin:d=e.margin}){const m=e.separatorStrokeWidth,u=e.barHeight,f=e.barMargin,x=e.overflowOffset,b=e.groupLabelMargin,y=e.labelLeft,w=e.labelBelow,v=e.lineColor,B=e.swatch.between,A=e.swatch.right,C=e.swatch.width,k=e.swatch.height,j=e.swatch.belowBetween,$=e.swatch.below,S=e.xAxisTop;var L=t.select(a).append("svg"),N=t.select("body").append("div").attr("class","tooltip"),P=document.querySelector(a).offsetWidth,V=P-d.left-d.right;const W=L.append("g").attr("class","sota-stackedBarChart-mainChart").attr("transform",`translate(${d.left+x} ${d.right})`).attr("width",V);t.csv(s+".csv").then(e=>{var a=u+f,s=e.length*a,g=0;"onBar"==c&&(a+=e.length*b,s+=e.length*b,g=b);const p=e.columns.slice(1),M=t.map(e,t=>t.group).keys();var O=[];r?e.forEach(t=>{let e=0,a=[];for(let l of p){let s=+t[l];a.push([s,e]),e+=s}O.push(a)}):e.forEach(e=>{let a=0,l=t.sum(p,t=>+e[t]),s=[];for(let t of p){let r=+e[t]/l*100;s.push([r,a,+e[t]]),a+=r}O.push(s)});const z=t.scaleBand().domain(M).range([0,s]).padding([.2]),I=t.scaleLinear().domain([0,100]).range([0,V]),Y=t.scaleOrdinal().domain(p).range(t.map(p,(t,e)=>"module-fill-"+(e+1)).keys());o&&(W.append("g").attr("class","sota-gen-axis sota-gen-xAxis").call(t.axisBottom(I).ticks(e.length).tickSize(-8)).attr("transform","translate(0 "+(s+S)+")"),s+=20+S);var X=0;if(h){let e=[];const a=L.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${d.top})`);if(a.selectAll("nothing").data(p).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(function(){e.push(this.getBBox().width)})).remove(),t.sum(e,t=>t)+3*B+2*A>V){let l=V-t.max(e)-C-B;a.selectAll(".sota-gen-legend-swatch").data(p).join("rect").attr("class",t=>"sota-gen-legend-swatch "+Y(t)).attr("x",l).attr("y",(t,e)=>(k+j)*e).attr("width",C).attr("height",k),a.selectAll(".sota-gen-legend-text").data(p).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",l+C+B).attr("y",(t,e)=>(k+j)*e+k/2).attr("alignment-baseline","central"),X=p.length*k+(p.length-1)*j+$}else{let l=V-(t.sum(e,t=>t)+p.length*(C+B)+(p.length-1)*A);a.selectAll(".sota-gen-legend-swatch").data(p).join("rect").attr("class",t=>"sota-gen-legend-swatch "+Y(t)).attr("x",(a,s)=>l+s*(C+B+A)+t.sum(e.slice(0,s),t=>t)).attr("y",0).attr("width",C).attr("height",k),a.selectAll(".sota-gen-legend-text").data(p).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(a,s)=>l+s*(C+B+A)+C+B+t.sum(e.slice(0,s),t=>t)).attr("y",k/2).attr("alignment-baseline","central"),X=k+$}}const H=W.selectAll(".sota-stackedBarChart-group").data(O).join("g").attr("class","sota-stackedBarChart-group").attr("transform",(t,e)=>"translate(0 "+(z(M[e])+g-f)+")");H.selectAll(".sota-stackedBarChart-bar").data(t=>t).join("rect").attr("class",(t,e)=>"sota-stackedBarChart-bar "+Y(e)).attr("x",t=>I(t[1])).attr("y",0).attr("width",t=>I(t[0])).attr("height",u).on("mouseover",(function(e,a){t.select(this).attr("opacity",.8),N.style("opacity",1).html(()=>{let t=`<span class="sota-tooltip-label">${p[a]}</span><br/>Percentage: ${l(e[0])}`;return r||(t+="<br/>Number of responses: "+e[2]),t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{N.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(e){t.select(this).attr("opacity",1),N.style("opacity",0)})),H.selectAll(".sota-stackedBarChart-separator").data(t=>t).join("rect").attr("class","sota-stackedBarChart-separator").attr("fill","white").attr("x",t=>I(t[1])+I(t[0])).attr("y",0).attr("width",t=>t[0]>0?m:0).attr("height",u),"onBar"==c&&W.selectAll(".sota-stackedBarChart-groupLabel-onBar").data(M).join("text").attr("class","sota-stackedBarChart-groupLabel-onBar sota-gen-groupLabel").text(t=>t).attr("alignment-baseline","bottom").attr("x",0).attr("y",t=>z(t));var q=0;if("onBar"==i)H.selectAll(".sota-stackedBarChart-label-onBar").data(t=>t).join("text").attr("class","sota-stackedBarChart-label-onBar").text(e=>t.format(".1f")(e[0])+"%").attr("alignment-baseline","central").attr("text-anchor","end").attr("x",t=>I(t[1])+I(t[0])-y).attr("y",u/2).call(n,d.left);else if("aboveBar"==i){var F=[];H.selectAll(".sota-stackedBarChart-label-aboveBar-text").data(t=>t).join("text").attr("class","sota-stackedBarChart-label-aboveBar-text").text((e,a)=>`${p[a]}: ${t.format(".1f")(e[0])}%`).attr("x",t=>I(t[1])+I(t[0])/2).attr("y",(function(t){return F.push([this.getBBox().x,this.getBBox().width]),-2*w})).attr("alignment-baseline","bottom");let e=[];!function t(a){if(a==F.length-1)return e[a]=-2,-2;if(F[a][0]+F[a][1]+y>F[a+1][0]){F[a+1][0]=F[a][0]+F[a][1]+y;let l=t(a+1)-1;return e[a]=l,l}return t(a+1),e[a]=-2,-2}(0),H.selectAll(".sota-stackedBarChart-label-aboveBar-line").data(t=>t).join("polyline").attr("class","sota-stackedBarChart-label-aboveBar-line").attr("points",(t,a)=>{let l=I(t[1])+I(t[0])/2,s=u/2,r=l,n=(e[a]+1)*w;return`${l},${s} ${r},${n} ${F[a][0]+F[a][1]},${n}`}).attr("stroke-width",m).attr("stroke",v).attr("fill","none"),H.selectAll(".sota-stackedBarChart-label-aboveBar-text").data(t=>t).join("text").attr("x",(t,e)=>F[e][0]).attr("y",(t,a)=>e[a]*w),q=-1*t.min(e)*w+20}const R=s+d.top+d.bottom+X+q;L.style("width",P+2*x+"px").attr("height",R).style("margin-left",-x),W.attr("transform",`translate(${x} ${d.top+X+q})`).attr("width",V)})},customBarChart:function({selector:a,dataFile:n,shapeFile:o,shapeWidth:i=300,inputIsPercentage:c=!1,margin:h=e.margin}){var g=t.select(a).append("svg"),p=t.select("body").append("div").attr("class","tooltip");const d=g.append("g").attr("class","sota-mainChart");var m=document.querySelector(a).offsetWidth;const u=e.separatorStrokeWidth,f=e.labelLeft,x=e.labelBelow,b=e.lineColor;t.xml("shapes/"+o+".svg").then(e=>{let a=document.importNode(e.documentElement,!0),o=t.select(a).select("path").node(),y=0,w=0;g.append(()=>o).attr("class",(function(){return y=this.getBBox().width,w=this.getBBox().height,""})).remove();let v=i/y,B=w*v;g.append("defs").append("clipPath").attr("id","shapeDef").append(()=>o).attr("transform",`scale(${v})`),t.csv(n+".csv").then(e=>{const[a,n,o]=r(e,c);let y=0,w=[];for(let t of e)w.push(y),y+=+t.value;const v=t.scaleLinear().domain([0,t.sum(e,t=>+t.value)]).range([0,i]),A=t.scaleOrdinal().domain(t.map(e,t=>t.label)).range(t.map(e,(t,e)=>"module-fill-"+(e+1)).keys());d.selectAll(".sota-customBarChart-bar").data(e).join("rect").attr("class",t=>"sota-customBarChart-bar "+A(t.label)).attr("x",(t,e)=>v(w[e])).attr("y",0).attr("width",t=>v(t.value)).attr("height",B).attr("clip-path","url(#shapeDef)").call(s,p,a,o,n),d.selectAll(".sota-customBarChart-separator").data(e).join("rect").attr("class","sota-customBarChart-separator").attr("x",(t,e)=>0==e?-u:v(w[e])).attr("y",0).attr("width",u).attr("height",B).attr("fill","white").attr("clip-path","url(#shapeDef)");var C=[];d.selectAll(".sota-customBarChart-label-aboveBar-text").data(e).join("text").attr("class","sota-customBarChart-label-aboveBar-text").text((t,e)=>`${t.label}: ${l(a[e])}`).attr("x",(t,e)=>v(w[e])+v(t.value)/2+f).attr("y",(function(t){return C.push([this.getBBox().x,this.getBBox().width]),B+3*x})).attr("alignment-baseline","top");let k=[];!function t(e){if(e==C.length-1)return k[e]=3,3;if(C[e][0]+C[e][1]+2*f>C[e+1][0]){C[e+1][0]=C[e][0]+C[e][1]+2*f;let a=t(e+1)+1;return k[e]=a,a}return t(e+1),k[e]=3,3}(0),d.selectAll(".sota-customBarChart-label-aboveBar-line").data(e).join("polyline").attr("class","sota-customBarChart-label-aboveBar-line").attr("points",(t,e)=>{let a=v(w[e])+v(t.value)/2,l=B-x,s=a,r=B+(k[e]+1)*x;return`${a},${l} ${s},${r} ${C[e][0]+C[e][1]},${r}`}).attr("stroke-width",u).attr("stroke",b).attr("fill","none"),d.selectAll(".sota-customBarChart-label-aboveBar-text").data(e).join("text").attr("x",(t,e)=>C[e][0]).attr("y",(t,e)=>B+k[e]*x);let j=t.max(k)*x+20,$=B+h.top+h.bottom+j;g.attr("height",$),d.attr("transform",`translate(${h.left} ${h.top})`).attr("width",m-h.left-h.right)})})},columnChart:function({selector:a,dataFile:l,inputIsPercentage:n=!1,displayPercentage:o=!0,totalResp:i=null,maxVal:c=null,minVal:h=null,mainHeight:g=e.mainHeight,showLegend:p=!1,margin:d={top:20,bottom:20,left:24,right:0}}){const m=e.overflowOffset,u=e.tickSize,f=e.labelAngle,x=e.swatch.between,b=e.swatch.right,y=e.swatch.width,w=e.swatch.height,v=e.swatch.belowBetween,B=e.swatch.below,A=t.select(a).append("svg"),C=t.select("body").append("div").attr("class","tooltip"),k=A.append("g").attr("class","sota-mainChart"),j=document.querySelector(a).offsetWidth,$=j-d.left-d.right;t.csv(l+".csv").then(e=>{const[l,S,L]=r(e,n,i),N=o||n?l:S;if(null===h)h=n||o?0:t.min(N);else if(!0===h)h=t.min(N);else if(isNaN(h)||""===h)throw"invalid minVal for graph on "+a;if(null===c)c=n||o?100:t.max(N);else if(!0===c)c=t.max(N);else if(isNaN(c)||""===c)throw"invalid maxVal for graph on "+a;const P=t.scaleBand().domain(L).range([0,$]).padding([.3]),V=t.scaleLinear().domain([h,c]).range([g,0]),W=t.scaleOrdinal().domain(L).range(t.map(L,(t,e)=>"module-fill-"+(e+1)).keys());let M,O=0,z=!1;if(p){let a=[];const l=A.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${d.top})`);if(l.selectAll("nothing").data(e).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t.label).attr("x",(function(){a.push(this.getBBox().width)})).remove(),t.sum(a,t=>t)+a.length*x+(a.length-1)*b>$){let e=$-t.max(a)-y-x;l.selectAll(".sota-gen-legend-swatch").data(L).join("rect").attr("class",t=>"sota-gen-legend-swatch "+W(t)).attr("x",e).attr("y",(t,e)=>(w+v)*e).attr("width",y).attr("height",w),l.selectAll(".sota-gen-legend-text").data(L).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",e+y+x).attr("y",(t,e)=>(w+v)*e+w/2).attr("alignment-baseline","central"),O=L.length*w+(L.length-1)*v+B}else{let e=$-(t.sum(a,t=>t)+L.length*(y+x)+(L.length-1)*b);l.selectAll(".sota-gen-legend-swatch").data(L).join("rect").attr("class",t=>"sota-gen-legend-swatch "+W(t)).attr("x",(l,s)=>e+s*(y+x+b)+t.sum(a.slice(0,s),t=>t)).attr("y",0).attr("width",y).attr("height",w),l.selectAll(".sota-gen-legend-text").data(L).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(l,s)=>e+s*(y+x+b)+y+x+t.sum(a.slice(0,s),t=>t)).attr("y",w/2).attr("alignment-baseline","central"),O=w+B}}else{M=k.append("g").attr("class","sota-gen-axis sota-gen-xAxis").call(t.axisBottom(P).tickSize(0)).attr("transform",`translate(0 ${g})`);const e=M.selectAll("text"),a=e.nodes();for(let t in a){if(t==a.length-1)continue;let e=a[+t].getBBox(),l=a[+t+1].getBBox();if(e.x+e.width>l.x){z=!0;break}}z&&e.attr("text-anchor","end").style("transform",`translateY(4px) rotate(-${f}deg)`)}k.append("g").attr("class","sota-gen-axis sota-gen-yAxis").call(t.axisLeft(V).tickSize(-u));if(k.selectAll(".sota-columnChart-bar").data(N).join("rect").attr("class",(t,e)=>{let a="sota-columnChart-bar sota-gen-bar";return a+=p?" "+W(L[e]):"",a}).attr("x",(t,e)=>P(L[e])).attr("y",t=>V(t)).attr("width",P.bandwidth()).attr("height",t=>g-V(t)).call(s,C,l,L,S),p)g+=O;else if(z){let e=[];const a=M.select("text").node().getBBox(),l=a.y,s=a.height;M.selectAll("text").each((function(){e.push(this.getBBox().width)}));const r=t.max(e)*Math.sin(f*Math.PI/180),n=s*Math.cos(f*Math.PI/180);g+=l+r+n}else{let e=[];M.selectAll("text").each((function(){e.push(this.getBBox().y+this.getBBox().height)})),g+=+t.max(e)}let I=g+d.top+d.bottom;A.style("width",j+2*m+"px").attr("height",I).style("margin-left",-m),k.attr("transform",`translate(${d.left+m} ${d.top+O})`).attr("width",$)})},groupedBarChart:function({selector:a,dataFile:s,totalResp:r=null,inputIsPercentage:n=!1,displayPercentage:o=!0,minVal:i=0,maxVal:c=null,margin:h=e.margin}){const g=e.groupedBarChart.barHeight,p=e.groupedBarChart.barMargin,d=e.overflowOffset,m=e.groupLabelMargin,u=e.xAxisTop,f=t.select(a).append("svg"),x=t.select("body").append("div").attr("class","tooltip"),b=f.append("g").attr("class","sota-mainChart"),y=document.querySelector(a).offsetWidth,w=y-h.left-h.right;t.csv(s+".csv").then(e=>{window.wow=e;const s=e.columns.splice(1),v=t.map(e,t=>t.group).keys(),B=t.map(e,e=>{let a=[];for(let t of s)a.push(+e[t]);return t.max(a)}).keys(),A=t.max(B,t=>+t);if(null==c)c=n||o?100:A;else if(isNaN(c)||""===c)throw"invalid maxVal for graph on "+a;const C=g+p,k=C*s.length;let j=(k+m)*e.length;const $=t.scaleLinear().domain([i,c]).range([0,w]),S=t.scaleOrdinal().domain(t.map(e,t=>t.group)).range(t.map(e,(t,e)=>(k+m)*e).keys()),L=t.scaleOrdinal().domain(s).range(t.map(s,(t,e)=>C*e).keys());b.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-groupedBarChart-xAxis").call(t.axisBottom($).tickSize(-(j+u))).attr("transform","translate(0 "+(j+u)+")");j+=20+u;const N=b.selectAll(".sota-groupedBarChart-group").data(e).join("g").attr("class","sota-groupedBarChart-group").attr("transform",(t,e)=>`translate(0 ${S(t.group)})`),P=t.scaleOrdinal().domain(s).range(t.map(s,(t,e)=>"module-fill-"+(e+1)).keys());N.selectAll(".sota-gen-bar").data(t=>{let e=[];for(let a of s)e.push(+t[a]);return e}).join("rect").attr("class",(t,e)=>"sota-gen-bar "+P(s[e])).attr("y",(t,e)=>+L(s[e])+ +m).attr("x",0).attr("width",(t,e)=>$(n?t:t/r[s[e]]*100)).attr("height",g).on("mouseover",(function(e,a){t.select(this).attr("opacity",.8),x.style("opacity",1).html(()=>{let t=`<span class="sota-tooltip-label">${s[a]}</span><br/>Percentage: ${l(n?e:e/r[s[a]]*100)}`;return n||(t+="<br/>Number of responses: "+e),t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{x.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(e){t.select(this).attr("opacity",1),x.style("opacity",0)})),b.selectAll(".sota-gen-groupLabel").data(v).join("text").attr("class","sota-gen-groupLabel").text(t=>t).attr("alignment-baseline","bottom").attr("x",0).attr("y",t=>+S(t)+ +m).attr("transform","translate(0 -8)");let V=j+h.top+h.bottom;f.style("width",y+2*d+"px").attr("height",V).style("margin-left",-d),b.attr("transform",`translate(${h.left+d} ${h.top})`).attr("width",w)})},stackedColumnChart:function({selector:a,dataFile:s,inputIsPercentage:r=!1,displayPercentage:n=!0,totalResp:o=null,maxVal:i=null,minVal:c=null,mainHeight:h=e.mainHeight,margin:g={top:20,bottom:20,left:24,right:0}}){const p=e.tickSize,d=e.separatorStrokeWidth,m=e.overflowOffset,u=e.swatch.between,f=e.swatch.right,x=e.swatch.width,b=e.swatch.height,y=e.swatch.belowBetween,w=e.swatch.below,v=t.select(a).append("svg"),B=t.select("body").append("div").attr("class","tooltip"),A=v.append("g").attr("class","sota-stackedColumnChart-mainChart"),C=document.querySelector(a).offsetWidth,k=C-g.left-g.right;t.csv(s+".csv").then(e=>{const s=e.columns.slice(1),o=t.map(e,t=>t.group).keys();var j=[];r?e.forEach(t=>{let e=0,a=[];for(let l of s){let s=+t[l];a.push([s,e]),e+=s}j.push(a)}):e.forEach(e=>{let a=0,l=t.sum(s,t=>+e[t]),r=[];for(let t of s){let s=+e[t]/l*100;r.push([s,a,+e[t]]),a+=s}j.push(r)});const $=n||r?j:e.map(t=>+t.value);if(null===c)c=r||n?0:t.min($);else if(!0===c)c=t.min($);else if(isNaN(c)||""===c)throw"invalid minVal for graph on "+a;if(null===i)i=r||n?100:t.max($);else if(!0===i)i=t.max($);else if(isNaN(i)||""===i)throw"invalid maxVal for graph on "+a;const S=t.scaleBand().domain(o).range([0,k]).padding([.3]),L=t.scaleLinear().domain([c,i]).range([h,0]),N=t.scaleOrdinal().domain(s).range(t.map(s,(t,e)=>"module-fill-"+(e+1)).keys()),P=(A.append("g").attr("class","sota-gen-axis sota-gen-yAxis").call(t.axisLeft(L).tickSize(-p)),A.append("g").attr("class","sota-gen-axis sota-gen-xAxis").call(t.axisBottom(S).ticks(e.length).tickSize(-p)).attr("transform","translate(0 "+h+")"));let V=0,W=[];const M=v.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${g.top})`);if(M.selectAll("nothing").data(s).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(function(){W.push(this.getBBox().width)})).remove(),t.sum(W,t=>t)+W.length*u+(W.length-1)*f>k){let e=k-t.max(W)-x-u;M.selectAll(".sota-gen-legend-swatch").data(s).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",e).attr("y",(t,e)=>(b+y)*e).attr("width",x).attr("height",b),M.selectAll(".sota-gen-legend-text").data(s).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",e+x+u).attr("y",(t,e)=>(b+y)*e+b/2).attr("alignment-baseline","central"),V=s.length*b+(s.length-1)*y+w}else{let e=k-(t.sum(W,t=>t)+s.length*(x+u)+(s.length-1)*f);M.selectAll(".sota-gen-legend-swatch").data(s).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",(a,l)=>e+l*(x+u+f)+t.sum(W.slice(0,l),t=>t)).attr("y",0).attr("width",x).attr("height",b),M.selectAll(".sota-gen-legend-text").data(s).join("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(a,l)=>e+l*(x+u+f)+x+u+t.sum(W.slice(0,l),t=>t)).attr("y",b/2).attr("alignment-baseline","central"),V=b+w}const O=A.selectAll(".sota-stackedColumnChart-group").data(j).join("g").attr("class","sota-stackedColumnChart-group").attr("transform",(t,e)=>"translate("+S(o[e])+" 0)");O.selectAll(".sota-stackedColumnChart-bar").data(t=>t).join("rect").attr("class",(t,e)=>"sota-stackedColumnChart-bar "+N(e)).attr("x",0).attr("y",t=>L(t[0]+t[1])).attr("width",S.bandwidth()).attr("height",t=>h-L(t[0])).on("mouseover",(function(e,a){t.select(this).attr("opacity",.8),B.style("opacity",1).html(()=>{let t=`<span class="sota-tooltip-label">${s[a]}</span><br/>Percentage: ${l(e[0])}`;return r||(t+="<br/>Number of responses: "+e[2]),t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{B.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(e){t.select(this).attr("opacity",1),B.style("opacity",0)})),O.selectAll(".sota-stackedColumnChart-separator").data(t=>t).join("rect").attr("class","sota-stackedColumnChart-separator").attr("fill","white").attr("x",0).attr("y",(t,e)=>L(t[0])+L(t[1])-h).attr("height",t=>t[0]>0?d:0).attr("width",S.bandwidth()),h+=V;{let e=[];P.selectAll("text").each((function(){e.push(this.getBBox().y+this.getBBox().height)})),h+=+t.max(e)}let z=h+g.top+g.bottom+V;v.style("width",C+2*m+"px").attr("height",z).style("margin-left",-m),A.attr("transform",`translate(${g.left+m} ${g.top+V})`).attr("width",k)})}};return i}));
